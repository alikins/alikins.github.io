

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ansible.module_utils.facts &mdash; Ansible 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Ansible 1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="simple">
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Ansible</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>ansible.module_utils.facts</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ansible.module_utils.facts</h1><div class="highlight"><pre>
<span class="c"># (c) 2012, Michael DeHaan &lt;michael.dehaan@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># This file is part of Ansible</span>
<span class="c">#</span>
<span class="c"># Ansible is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># Ansible is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with Ansible.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">pwd</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># python2</span>
    <span class="kn">import</span> <span class="nn">ConfigParser</span> <span class="kn">as</span> <span class="nn">configparser</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c"># python3</span>
    <span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">from</span> <span class="nn">ansible.module_utils.basic</span> <span class="kn">import</span> <span class="n">get_all_subclasses</span>

<span class="c"># py2 vs py3; replace with six via ziploader</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c"># python2</span>
    <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c"># python3</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>


<span class="k">try</span><span class="p">:</span>
    <span class="c"># python2</span>
    <span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">maketrans</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c"># python3</span>
    <span class="n">maketrans</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span> <span class="c"># TODO: is this really identical?</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">dict</span><span class="o">.</span><span class="n">iteritems</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="c"># Python 3</span>
    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># Python 2</span>
<div class="viewcode-block" id="iteritems"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span></div>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># Python 2</span>
    <span class="nb">long</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c"># Python 3</span>
    <span class="nb">long</span> <span class="o">=</span> <span class="nb">int</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">selinux</span>
    <span class="n">HAVE_SELINUX</span><span class="o">=</span><span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAVE_SELINUX</span><span class="o">=</span><span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># Check if we have SSLContext support</span>
    <span class="kn">from</span> <span class="nn">ssl</span> <span class="kn">import</span> <span class="n">create_default_context</span><span class="p">,</span> <span class="n">SSLContext</span>
    <span class="k">del</span> <span class="n">create_default_context</span>
    <span class="k">del</span> <span class="n">SSLContext</span>
    <span class="n">HAS_SSLCONTEXT</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAS_SSLCONTEXT</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="c"># Detect python-json which is incompatible and fallback to simplejson in</span>
    <span class="c"># that case</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">loads</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dumps</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simplejson</span> <span class="kn">as</span> <span class="nn">json</span>

<span class="c"># The distutils module is not shipped with SUNWPython on Solaris.</span>
<span class="c"># It&#39;s in the SUNWPython-devel package which also contains development files</span>
<span class="c"># that don&#39;t belong on production boxes.  Since our Solaris code doesn&#39;t</span>
<span class="c"># depend on LooseVersion, do not import it on Solaris.</span>
<span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;SunOS&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">distutils.version</span> <span class="kn">import</span> <span class="n">LooseVersion</span>


<span class="c"># --------------------------------------------------------------</span>
<span class="c"># timeout function to make sure some fact gathering</span>
<span class="c"># steps do not exceed a time limit</span>

<div class="viewcode-block" id="TimeoutError"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.TimeoutError">[docs]</a><span class="k">class</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="timeout"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.timeout">[docs]</a><span class="k">def</span> <span class="nf">timeout</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="s">&quot;Timer expired&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_handle_timeout</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TimeoutError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">_handle_timeout</span><span class="p">)</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span></div>

<span class="c"># --------------------------------------------------------------</span>

<div class="viewcode-block" id="Facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts">[docs]</a><span class="k">class</span> <span class="nc">Facts</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class should only attempt to populate those facts that</span>
<span class="sd">    are mostly generic to all systems.  This includes platform facts,</span>
<span class="sd">    service facts (e.g. ssh keys or selinux), and distribution facts.</span>
<span class="sd">    Anything that requires extensive code or may have more than one</span>
<span class="sd">    possible implementation to establish facts for a given topic should</span>
<span class="sd">    subclass Facts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># i86pc is a Solaris and derivatives-ism</span>
    <span class="n">_I386RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;i([3456]86|86pc)&#39;</span><span class="p">)</span>
    <span class="c"># For the most part, we assume that platform.dist() will tell the truth.</span>
    <span class="c"># This is the fallback to handle unknowns or exceptions</span>
    <span class="n">SELINUX_MODE_DICT</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;enforcing&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;permissive&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;disabled&#39;</span> <span class="p">}</span>

    <span class="c"># A list of dicts.  If there is a platform with more than one</span>
    <span class="c"># package manager, put the preferred one last.  If there is an</span>
    <span class="c"># ansible module, use that as the value for the &#39;name&#39; key.</span>
    <span class="n">PKG_MGRS</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/yum&#39;</span><span class="p">,</span>         <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;yum&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/dnf&#39;</span><span class="p">,</span>         <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;dnf&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/apt-get&#39;</span><span class="p">,</span>     <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;apt&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/zypper&#39;</span><span class="p">,</span>      <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;zypper&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/sbin/urpmi&#39;</span><span class="p">,</span>      <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;urpmi&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/pacman&#39;</span><span class="p">,</span>      <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;pacman&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/bin/opkg&#39;</span><span class="p">,</span>            <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;opkg&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/pkg/bin/pkgin&#39;</span><span class="p">,</span>   <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;pkgin&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/opt/local/bin/pkgin&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;pkgin&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/opt/local/bin/port&#39;</span><span class="p">,</span>  <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;macports&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/local/bin/brew&#39;</span><span class="p">,</span>  <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;homebrew&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/sbin/apk&#39;</span><span class="p">,</span>            <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;apk&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/sbin/pkg&#39;</span><span class="p">,</span>        <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;pkgng&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/sbin/swlist&#39;</span><span class="p">,</span>     <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;SD-UX&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/emerge&#39;</span><span class="p">,</span>      <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;portage&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/sbin/pkgadd&#39;</span><span class="p">,</span>     <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;svr4pkg&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/pkg&#39;</span><span class="p">,</span>         <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;pkg&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/bin/xbps-install&#39;</span><span class="p">,</span><span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;xbps&#39;</span> <span class="p">},</span>
                 <span class="p">{</span> <span class="s">&#39;path&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/local/sbin/pkg&#39;</span><span class="p">,</span>  <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;pkgng&#39;</span> <span class="p">},</span>
                <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">load_on_init</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cached_facts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_facts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span> <span class="o">=</span> <span class="n">cached_facts</span>    
        <span class="c">### TODO: Eventually, these should all get moved to populate().  But</span>
        <span class="c"># some of the values are currently being used by other subclasses (for</span>
        <span class="c"># instance, os_family and distribution).  Have to sort out what to do</span>
        <span class="c"># about those first.</span>
        <span class="k">if</span> <span class="n">load_on_init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_platform_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Distribution</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cmdline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_public_ssh_host_keys</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_selinux_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_caps_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_fips_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_pkg_mgr_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_service_mgr_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_lsb_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_date_time_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_user_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_local_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_env_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_dns_facts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_python_facts</span><span class="p">()</span>


<div class="viewcode-block" id="Facts.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

    <span class="c"># Platform</span>
    <span class="c"># platform.system() can be Linux, Darwin, Java, or Windows</span>
<div class="viewcode-block" id="Facts.get_platform_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_platform_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_platform_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;kernel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;machine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;python_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;fqdn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;nodename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;fqdn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">arch_bits</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_bits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_bits</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;bit&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;machine&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;x86_64&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;machine&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_bits&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;64&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;x86_64&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_bits&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;32&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i386&#39;</span>
        <span class="k">elif</span> <span class="n">Facts</span><span class="o">.</span><span class="n">_I386RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;machine&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i386&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_bits&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;64&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;x86_64&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_bits&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;32&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;userspace_architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i386&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;machine&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;AIX&#39;</span><span class="p">:</span>
            <span class="c"># Attempt to use getconf to figure out architecture</span>
            <span class="c"># fall back to bootinfo if needed</span>
            <span class="n">getconf_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;getconf&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">getconf_bin</span><span class="p">:</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">getconf_bin</span><span class="p">,</span> <span class="s">&#39;MACHINE_ARCHITECTURE&#39;</span><span class="p">])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bootinfo_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;bootinfo&#39;</span><span class="p">)</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">bootinfo_bin</span><span class="p">,</span> <span class="s">&#39;-p&#39;</span><span class="p">])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;OpenBSD&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">machine_id</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&quot;/var/lib/dbus/machine-id&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&quot;/etc/machine-id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">machine_id</span><span class="p">:</span>
            <span class="n">machine_id</span> <span class="o">=</span> <span class="n">machine_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&quot;machine_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">machine_id</span></div>

<div class="viewcode-block" id="Facts.get_local_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_local_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_local_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fact_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fact_path&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fact_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fact_path</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">local</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fact_path</span> <span class="o">+</span> <span class="s">&#39;/*.fact&#39;</span><span class="p">)):</span>
            <span class="c"># where it will sit under local facts</span>
            <span class="n">fact_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.fact&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXUSR</span> <span class="o">&amp;</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fn</span><span class="p">)[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_MODE</span><span class="p">]:</span>
                <span class="c"># run it</span>
                <span class="c"># try to read it as json first</span>
                <span class="c"># if that fails read it with ConfigParser</span>
                <span class="c"># if that fails, skip it</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

            <span class="c"># load raw json</span>
            <span class="n">fact</span> <span class="o">=</span> <span class="s">&#39;loading </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fact_base</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fact</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c"># load raw ini</span>
                <span class="n">cp</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cp</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">configparser</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                    <span class="n">fact</span> <span class="o">=</span> <span class="s">&quot;error loading fact - please check content&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fact</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">sect</span> <span class="ow">in</span> <span class="n">cp</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">sect</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fact</span><span class="p">:</span>
                            <span class="n">fact</span><span class="p">[</span><span class="n">sect</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">cp</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">sect</span><span class="p">):</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sect</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
                            <span class="n">fact</span><span class="p">[</span><span class="n">sect</span><span class="p">][</span><span class="n">opt</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>

            <span class="n">local</span><span class="p">[</span><span class="n">fact_base</span><span class="p">]</span> <span class="o">=</span> <span class="n">fact</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">local</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;local&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local</span></div>

<div class="viewcode-block" id="Facts.get_cmdline"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_cmdline">[docs]</a>    <span class="k">def</span> <span class="nf">get_cmdline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/proc/cmdline&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;cmdline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">piece</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;cmdline&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;cmdline&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="Facts.get_public_ssh_host_keys"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_public_ssh_host_keys">[docs]</a>    <span class="k">def</span> <span class="nf">get_public_ssh_host_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">keytypes</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dsa&#39;</span><span class="p">,</span> <span class="s">&#39;rsa&#39;</span><span class="p">,</span> <span class="s">&#39;ecdsa&#39;</span><span class="p">,</span> <span class="s">&#39;ed25519&#39;</span><span class="p">)</span>

        <span class="c"># list of directories to check for ssh keys</span>
        <span class="c"># used in the order listed here, the first one with keys is used</span>
        <span class="n">keydirs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/etc/ssh&#39;</span><span class="p">,</span> <span class="s">&#39;/etc/openssh&#39;</span><span class="p">,</span> <span class="s">&#39;/etc&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">keydir</span> <span class="ow">in</span> <span class="n">keydirs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="n">keytypes</span><span class="p">:</span>
                <span class="n">factname</span> <span class="o">=</span> <span class="s">&#39;ssh_host_key_</span><span class="si">%s</span><span class="s">_public&#39;</span> <span class="o">%</span> <span class="n">type_</span>
                <span class="k">if</span> <span class="n">factname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">:</span>
                    <span class="c"># a previous keydir was already successful, stop looking</span>
                    <span class="c"># for keys</span>
                    <span class="k">return</span>
                <span class="n">key_filename</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/ssh_host_</span><span class="si">%s</span><span class="s">_key.pub&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">keydir</span><span class="p">,</span> <span class="n">type_</span><span class="p">)</span>
                <span class="n">keydata</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">key_filename</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keydata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">factname</span><span class="p">]</span> <span class="o">=</span> <span class="n">keydata</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Facts.get_pkg_mgr_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_pkg_mgr_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_pkg_mgr_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;OpenBSD&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;pkg_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;openbsd_pkg&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;pkg_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>
            <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">Facts</span><span class="o">.</span><span class="n">PKG_MGRS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pkg</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;pkg_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pkg</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Facts.get_service_mgr_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_service_mgr_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_service_mgr_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#TODO: detect more custom init setups like bootscripts, dmd, s6, Epoch, runit, etc</span>
        <span class="c"># also other OSs other than linux might need to check across several possible candidates</span>

        <span class="c"># try various forms of querying pid 1</span>
        <span class="n">proc_1</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/proc/1/comm&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proc_1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">proc_1</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;ps -p 1 -o comm|tail -n 1&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proc_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">proc_1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">proc_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">proc_1</span> <span class="o">=</span> <span class="n">proc_1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">proc_1</span> <span class="o">==</span> <span class="s">&#39;init&#39;</span> <span class="ow">or</span> <span class="n">proc_1</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;sh&#39;</span><span class="p">):</span>
            <span class="c"># many systems return init, so this cannot be trusted, if it ends in &#39;sh&#39; it probalby is a shell in a container</span>
            <span class="n">proc_1</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># if not init/None it should be an identifiable or custom init, so we are done!</span>
        <span class="k">if</span> <span class="n">proc_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_1</span>

        <span class="c"># start with the easy ones</span>
        <span class="k">elif</span>  <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;MacOSX&#39;</span><span class="p">:</span>
            <span class="c">#FIXME: find way to query executable, version matching is not ideal</span>
            <span class="k">if</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">mac_ver</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="s">&#39;10.4&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;launchd&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;systemstarter&#39;</span>
        <span class="k">elif</span> <span class="s">&#39;BSD&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Bitrig&#39;</span><span class="p">,</span> <span class="s">&#39;DragonFly&#39;</span><span class="p">]:</span>
            <span class="c">#FIXME: we might want to break out to individual BSDs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bsdinit&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;AIX&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;src&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;SunOS&#39;</span><span class="p">:</span>
            <span class="c">#FIXME: smf?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;svcs&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Linux&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_systemd_managed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;systemd&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;initctl&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;/etc/init/&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;upstart&#39;</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s">&#39;/sbin/rc&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;/sbin/openrc&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;openrc&#39;</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/etc/init.d/&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;sysvinit&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;service_mgr&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="c"># if we cannot detect, fallback to generic &#39;service&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;service_mgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;service&#39;</span></div>

<div class="viewcode-block" id="Facts.get_lsb_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_lsb_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_lsb_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lsb_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;lsb_release&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lsb_path</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">lsb_path</span><span class="p">,</span> <span class="s">&quot;-a&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="s">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s">&#39;LSB Version:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="s">&#39;Distributor ID:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="s">&#39;Description:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="s">&#39;Release:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="s">&#39;Codename:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;codename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">lsb_path</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/etc/lsb-release&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/etc/lsb-release&#39;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&#39;DISTRIB_ID&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="s">&#39;DISTRIB_RELEASE&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="s">&#39;DISTRIB_DESCRIPTION&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="s">&#39;DISTRIB_CODENAME&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;codename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s">&#39;lsb&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span> <span class="ow">and</span> <span class="s">&#39;release&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;major_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lsb&#39;</span><span class="p">][</span><span class="s">&#39;release&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Facts.get_selinux_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_selinux_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_selinux_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAVE_SELINUX</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selinux</span><span class="o">.</span><span class="n">is_selinux_enabled</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;disabled&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;enabled&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;policyvers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selinux</span><span class="o">.</span><span class="n">security_policyvers</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;policyvers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">configmode</span><span class="p">)</span> <span class="o">=</span> <span class="n">selinux</span><span class="o">.</span><span class="n">selinux_getenforcemode</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;config_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Facts</span><span class="o">.</span><span class="n">SELINUX_MODE_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">configmode</span><span class="p">,</span> <span class="s">&#39;unknown&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;config_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;config_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">selinux</span><span class="o">.</span><span class="n">security_getenforce</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Facts</span><span class="o">.</span><span class="n">SELINUX_MODE_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s">&#39;unknown&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">policytype</span><span class="p">)</span> <span class="o">=</span> <span class="n">selinux</span><span class="o">.</span><span class="n">selinux_getpolicytype</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">policytype</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;selinux&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span></div>

<div class="viewcode-block" id="Facts.get_caps_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_caps_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_caps_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">capsh_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;capsh&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">capsh_path</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">capsh_path</span><span class="p">,</span> <span class="s">&quot;--print&quot;</span><span class="p">])</span>
            <span class="n">enforced_caps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">enforced</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Current:&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;=ep&#39;</span><span class="p">:</span>
                        <span class="n">enforced</span> <span class="o">=</span> <span class="s">&#39;False&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">enforced</span> <span class="o">=</span> <span class="s">&#39;True&#39;</span>
                        <span class="n">enforced_caps</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system_capabilities_enforced&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enforced</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;system_capabilities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enforced_caps</span></div>


<div class="viewcode-block" id="Facts.get_fips_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_fips_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_fips_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;fips&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/proc/sys/crypto/fips_enabled&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;fips&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>


<div class="viewcode-block" id="Facts.get_date_time_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_date_time_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_date_time_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;weekday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%A&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;weekday_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;weeknumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%W&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%H&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;minute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%M&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;epoch&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;%&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;iso8601_micro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S.</span><span class="si">%f</span><span class="s">Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;iso8601&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%SZ&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;iso8601_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">T%H%M%S</span><span class="si">%f</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;iso8601_basic_short&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">T%H%M%S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;tz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;date_time&#39;</span><span class="p">][</span><span class="s">&#39;tz_offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%z&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Facts.is_systemd_managed"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.is_systemd_managed">[docs]</a>    <span class="k">def</span> <span class="nf">is_systemd_managed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># tools must be installed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;systemctl&#39;</span><span class="p">):</span>

            <span class="c"># this should show if systemd is the boot init system, if checking init faild to mark as systemd</span>
            <span class="c"># these mirror systemd&#39;s own sd_boot test http://www.freedesktop.org/software/systemd/man/sd_booted.html</span>
            <span class="k">for</span> <span class="n">canary</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;/run/systemd/system/&quot;</span><span class="p">,</span> <span class="s">&quot;/dev/.run/systemd/&quot;</span><span class="p">,</span> <span class="s">&quot;/dev/.systemd/&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">canary</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>

    <span class="c"># User</span>
<div class="viewcode-block" id="Facts.get_user_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_user_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
        <span class="n">pwent</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwnam</span><span class="p">(</span><span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;user_uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwent</span><span class="o">.</span><span class="n">pw_uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;user_gid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwent</span><span class="o">.</span><span class="n">pw_gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;user_gecos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwent</span><span class="o">.</span><span class="n">pw_gecos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;user_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwent</span><span class="o">.</span><span class="n">pw_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;user_shell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwent</span><span class="o">.</span><span class="n">pw_shell</span></div>

<div class="viewcode-block" id="Facts.get_env_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_env_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_env_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;env&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>

<div class="viewcode-block" id="Facts.get_dns_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_dns_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_dns_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/resolv.conf&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nameserver&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;nameservers&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;nameservers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">nameserver</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;nameservers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nameserver</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;domain&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;search&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;search&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;search&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;sortlist&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;sortlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;sortlist&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;options&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">option_tokens</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">option_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;dns&#39;</span><span class="p">][</span><span class="s">&#39;options&#39;</span><span class="p">][</span><span class="n">option_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span></div>

    <span class="k">def</span> <span class="nf">_get_mount_size_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">):</span>
        <span class="n">size_total</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">size_available</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">statvfs_result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">statvfs</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">)</span>
            <span class="n">size_total</span> <span class="o">=</span> <span class="n">statvfs_result</span><span class="o">.</span><span class="n">f_bsize</span> <span class="o">*</span> <span class="n">statvfs_result</span><span class="o">.</span><span class="n">f_blocks</span>
            <span class="n">size_available</span> <span class="o">=</span> <span class="n">statvfs_result</span><span class="o">.</span><span class="n">f_bsize</span> <span class="o">*</span> <span class="p">(</span><span class="n">statvfs_result</span><span class="o">.</span><span class="n">f_bavail</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">size_total</span><span class="p">,</span> <span class="n">size_available</span>

<div class="viewcode-block" id="Facts.get_python_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facts.get_python_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_python_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;python&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;major&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s">&#39;minor&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s">&#39;micro&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s">&#39;releaselevel&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="s">&#39;serial&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s">&#39;version_info&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">),</span>
            <span class="s">&#39;executable&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
            <span class="s">&#39;has_sslcontext&#39;</span><span class="p">:</span> <span class="n">HAS_SSLCONTEXT</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;python&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">subversion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;python&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span></div></div>


<div class="viewcode-block" id="Distribution"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution">[docs]</a><span class="k">class</span> <span class="nc">Distribution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This subclass of Facts fills the distribution, distribution_version and distribution_release variables</span>

<span class="sd">    To do so it checks the existance and content of typical files in /etc containing distribution information</span>

<span class="sd">    This is unit tested. Please extend the tests to cover all distributions if you have them available.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># every distribution name mentioned here, must have one of</span>
    <span class="c">#  - allowempty == True</span>
    <span class="c">#  - be listed in SEARCH_STRING</span>
    <span class="c">#  - have a function get_distribution_DISTNAME implemented</span>
    <span class="n">OSDIST_LIST</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/oracle-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;OracleLinux&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/slackware-version&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Slackware&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/redhat-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;RedHat&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/vmware-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;VMwareESX&#39;</span><span class="p">,</span> <span class="s">&#39;allowempty&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/openwrt_release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;OpenWrt&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/system-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Amazon&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/alpine-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Alpine&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Solaris&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/arch-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Archlinux&#39;</span><span class="p">,</span> <span class="s">&#39;allowempty&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/os-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;SuSE&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/SuSE-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;SuSE&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/gentoo-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Gentoo&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/os-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Debian&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/lsb-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Mandriva&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/altlinux-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Altlinux&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/os-release&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;NA&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/etc/coreos/update.conf&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Coreos&#39;</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="n">SEARCH_STRING</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;OracleLinux&#39;</span><span class="p">:</span> <span class="s">&#39;Oracle Linux&#39;</span><span class="p">,</span>
        <span class="s">&#39;RedHat&#39;</span><span class="p">:</span> <span class="s">&#39;Red Hat&#39;</span><span class="p">,</span>
        <span class="s">&#39;Altlinux&#39;</span><span class="p">:</span> <span class="s">&#39;ALT Linux&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c"># A list with OS Family members</span>
    <span class="n">OS_FAMILY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">RedHat</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">Fedora</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">CentOS</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">Scientific</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span>
        <span class="n">SLC</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">Ascendos</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">CloudLinux</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">PSBM</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span>
        <span class="n">OracleLinux</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">OVS</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">OEL</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">Amazon</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span>
        <span class="n">XenServer</span> <span class="o">=</span> <span class="s">&#39;RedHat&#39;</span><span class="p">,</span> <span class="n">Ubuntu</span> <span class="o">=</span> <span class="s">&#39;Debian&#39;</span><span class="p">,</span> <span class="n">Debian</span> <span class="o">=</span> <span class="s">&#39;Debian&#39;</span><span class="p">,</span> <span class="n">Raspbian</span> <span class="o">=</span> <span class="s">&#39;Debian&#39;</span><span class="p">,</span> <span class="n">Slackware</span> <span class="o">=</span> <span class="s">&#39;Slackware&#39;</span><span class="p">,</span> <span class="n">SLES</span> <span class="o">=</span> <span class="s">&#39;Suse&#39;</span><span class="p">,</span>
        <span class="n">SLED</span> <span class="o">=</span> <span class="s">&#39;Suse&#39;</span><span class="p">,</span> <span class="n">openSUSE</span> <span class="o">=</span> <span class="s">&#39;Suse&#39;</span><span class="p">,</span> <span class="n">SuSE</span> <span class="o">=</span> <span class="s">&#39;Suse&#39;</span><span class="p">,</span> <span class="n">SLES_SAP</span> <span class="o">=</span> <span class="s">&#39;Suse&#39;</span><span class="p">,</span> <span class="n">Gentoo</span> <span class="o">=</span> <span class="s">&#39;Gentoo&#39;</span><span class="p">,</span> <span class="n">Funtoo</span> <span class="o">=</span> <span class="s">&#39;Gentoo&#39;</span><span class="p">,</span>
        <span class="n">Archlinux</span> <span class="o">=</span> <span class="s">&#39;Archlinux&#39;</span><span class="p">,</span> <span class="n">Manjaro</span> <span class="o">=</span> <span class="s">&#39;Archlinux&#39;</span><span class="p">,</span> <span class="n">Mandriva</span> <span class="o">=</span> <span class="s">&#39;Mandrake&#39;</span><span class="p">,</span> <span class="n">Mandrake</span> <span class="o">=</span> <span class="s">&#39;Mandrake&#39;</span><span class="p">,</span> <span class="n">Altlinux</span> <span class="o">=</span> <span class="s">&#39;Altlinux&#39;</span><span class="p">,</span>
        <span class="n">Solaris</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span><span class="p">,</span> <span class="n">Nexenta</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span><span class="p">,</span> <span class="n">OmniOS</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span><span class="p">,</span> <span class="n">OpenIndiana</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span><span class="p">,</span>
        <span class="n">SmartOS</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span><span class="p">,</span> <span class="n">AIX</span> <span class="o">=</span> <span class="s">&#39;AIX&#39;</span><span class="p">,</span> <span class="n">Alpine</span> <span class="o">=</span> <span class="s">&#39;Alpine&#39;</span><span class="p">,</span> <span class="n">MacOSX</span> <span class="o">=</span> <span class="s">&#39;Darwin&#39;</span><span class="p">,</span>
        <span class="n">FreeBSD</span> <span class="o">=</span> <span class="s">&#39;FreeBSD&#39;</span><span class="p">,</span> <span class="n">HPUX</span> <span class="o">=</span> <span class="s">&#39;HP-UX&#39;</span><span class="p">,</span> <span class="n">openSUSE_Leap</span> <span class="o">=</span> <span class="s">&#39;Suse&#39;</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>

<div class="viewcode-block" id="Distribution.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_distribution_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The platform module provides information about the running</span>
        <span class="c"># system/distribution. Use this as a baseline and fix buggy systems</span>
        <span class="c"># afterwards</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>

        <span class="n">systems_implemented</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;AIX&#39;</span><span class="p">,</span> <span class="s">&#39;HP-UX&#39;</span><span class="p">,</span> <span class="s">&#39;Darwin&#39;</span><span class="p">,</span> <span class="s">&#39;FreeBSD&#39;</span><span class="p">,</span> <span class="s">&#39;OpenBSD&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="ow">in</span> <span class="n">systems_implemented</span><span class="p">:</span>
            <span class="n">cleanedname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">distfunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;get_distribution_&#39;</span><span class="o">+</span><span class="n">cleanedname</span><span class="p">)</span>
            <span class="n">distfunc</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Linux&#39;</span><span class="p">:</span>
            <span class="c"># try to find out which linux distribution this is</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">dist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;NA&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;NA&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_major_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;NA&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;NA&#39;</span>
            <span class="c"># Try to handle the exceptions now ...</span>
            <span class="c"># self.facts[&#39;distribution_debug&#39;] = []</span>
            <span class="k">for</span> <span class="n">ddict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">OSDIST_LIST</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c"># if allowempty is set, we only check for file existance but not content</span>
                <span class="k">if</span> <span class="s">&#39;allowempty&#39;</span> <span class="ow">in</span> <span class="n">ddict</span> <span class="ow">and</span> <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;allowempty&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SEARCH_STRING</span><span class="p">:</span>
                    <span class="c"># look for the distribution string in the data and replace according to RELEASE_NAME_MAP</span>
                    <span class="c"># only the distribution name is set, the version is assumed to be correct from platform.dist()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SEARCH_STRING</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                        <span class="c"># this sets distribution=RedHat if &#39;Red Hat&#39; shows up in data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># this sets distribution to what&#39;s in the data, e.g. CentOS, Scientific, ...</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># call a dedicated function for parsing the file content</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">distfunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;get_distribution_&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
                        <span class="n">parsed</span> <span class="o">=</span> <span class="n">distfunc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">parsed</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">parsed</span><span class="p">:</span>
                            <span class="c"># distfunc return False if parsing failed</span>
                            <span class="c"># break only if parsing was succesful</span>
                            <span class="c"># otherwise continue with other distributions</span>
                            <span class="k">break</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="c"># this should never happen, but if it does fail quitely and not with a traceback</span>
                        <span class="k">pass</span>



                    <span class="c"># to debug multiple matching release files, one can use:</span>
                    <span class="c"># self.facts[&#39;distribution_debug&#39;].append({path + &#39; &#39; + name:</span>
                    <span class="c">#         (parsed,</span>
                    <span class="c">#          self.facts[&#39;distribution&#39;],</span>
                    <span class="c">#          self.facts[&#39;distribution_version&#39;],</span>
                    <span class="c">#          self.facts[&#39;distribution_release&#39;],</span>
                    <span class="c">#          )})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;os_family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span>
        <span class="n">distro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distro</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">OS_FAMILY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;os_family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OS_FAMILY</span><span class="p">[</span><span class="n">distro</span><span class="p">]</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_AIX"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_AIX">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_AIX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/oslevel&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_HPUX"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_HPUX">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_HPUX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/swlist |egrep &#39;HPUX.*OE.*[AB].[0-9]+\.[0-9]+&#39;&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;HPUX.*OE.*([AB].[0-9]+\.[0-9]+)\.([0-9]+).*&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Darwin"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Darwin">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Darwin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;MacOSX&#39;</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/sw_vers -productVersion&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_FreeBSD"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_FreeBSD">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_FreeBSD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;(\d+)\.(\d+)-RELEASE.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_major_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_OpenBSD"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_OpenBSD">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_OpenBSD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/sbin/sysctl -n kern.version&quot;</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;OpenBSD\s[0-9]+.[0-9]+-(\S+)\s.*&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;release&#39;</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Slackware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Slackware">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Slackware</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;Slackware&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;\w+[.]\w+&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Amazon"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Amazon">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Amazon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;Amazon&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Amazon&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_OpenWrt"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_OpenWrt">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_OpenWrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;OpenWrt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;DISTRIB_RELEASE=&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;DISTRIB_CODENAME=&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Alpine"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Alpine">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Alpine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Alpine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Solaris"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Solaris">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Solaris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;Solaris&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">ora_prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="s">&#39;Oracle Solaris&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;Oracle &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">ora_prefix</span> <span class="o">=</span> <span class="s">&#39;Oracle &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ora_prefix</span> <span class="o">+</span> <span class="n">data</span>
            <span class="k">return</span>

        <span class="n">uname_rc</span><span class="p">,</span> <span class="n">uname_out</span><span class="p">,</span> <span class="n">uname_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="s">&#39;uname&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">])</span>
        <span class="n">distribution_version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;SmartOS&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;SmartOS&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/etc/product&#39;</span><span class="p">):</span>
                <span class="n">product_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;: &#39;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Image&#39;</span> <span class="ow">in</span> <span class="n">product_data</span><span class="p">:</span>
                    <span class="n">distribution_version</span> <span class="o">=</span> <span class="n">product_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Image&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s">&#39;OpenIndiana&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;OpenIndiana&#39;</span>
        <span class="k">elif</span> <span class="s">&#39;OmniOS&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;OmniOS&#39;</span>
            <span class="n">distribution_version</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">uname_rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s">&#39;NexentaOS_&#39;</span> <span class="ow">in</span> <span class="n">uname_out</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Nexenta&#39;</span>
            <span class="n">distribution_version</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;SmartOS&#39;</span><span class="p">,</span> <span class="s">&#39;OpenIndiana&#39;</span><span class="p">,</span> <span class="s">&#39;OmniOS&#39;</span><span class="p">,</span> <span class="s">&#39;Nexenta&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">distribution_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution_version</span>
            <span class="k">elif</span> <span class="n">uname_rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uname_out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove if tested without this</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_SuSE"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_SuSE">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_SuSE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;suse&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove if tested without this</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#39;/etc/os-release&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">distribution</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^NAME=(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">distribution</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
                <span class="c"># example pattern are 13.04 13.0 13</span>
                <span class="n">distribution_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;^VERSION_ID=&quot;?([0-9]+\.?[0-9]*)&quot;?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">distribution_version</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution_version</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;open&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^PRETTY_NAME=[^(]+ \(?([^)]+?)\)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s">&#39;enterprise&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="s">&#39;VERSION_ID&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="c"># SLES doesn&#39;t got funny release names</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;^VERSION_ID=&quot;?[0-9]+\.?([0-9]*)&quot;?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">release</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">release</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>  <span class="c"># no minor number, so it is the first release</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span>
        <span class="k">elif</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#39;/etc/SuSE-release&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;open&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="n">distdata</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distdata</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;CODENAME *= *([^</span><span class="se">\n</span><span class="s">]+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="s">&#39;enterprise&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="n">distribution</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="s">&quot;Server&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;SLES&quot;</span>
                <span class="k">elif</span> <span class="s">&quot;Desktop&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;SLED&quot;</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;PATCHLEVEL = ([0-9]+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="c"># SLES doesn&#39;t got funny release names</span>
                    <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">release</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Debian"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Debian">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Debian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;Debian&#39;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s">&#39;Raspbian&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Debian&#39;</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;PRETTY_NAME=[^(]+ \(?([^)]+?)\)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s">&#39;Ubuntu&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Ubuntu&#39;</span>
            <span class="k">pass</span>  <span class="c"># Ubuntu gets correct info from python functions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove if tested without this</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Mandriva"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Mandriva">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Mandriva</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;Mandriva&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Mandriva&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;DISTRIB_RELEASE=&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;DISTRIB_CODENAME=&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_NA"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_NA">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_NA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">distribution</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^NAME=(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">distribution</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;NA&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^VERSION=(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;NA&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Distribution.get_distribution_Coreos"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Distribution.get_distribution_Coreos">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution_Coreos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;coreos&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="c"># include fix from #15230, #15228</span>
                <span class="k">return</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^GROUP=(.*)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">release</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># TODO: remove if tested without this</span></div></div>


<div class="viewcode-block" id="Hardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Hardware">[docs]</a><span class="k">class</span> <span class="nc">Hardware</span><span class="p">(</span><span class="n">Facts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a generic Hardware subclass of Facts.  This should be further</span>
<span class="sd">    subclassed to implement per platform.  If you subclass this, it</span>
<span class="sd">    should define:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor (a list)</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>

<span class="sd">    All subclasses MUST define platform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Generic&#39;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keyword</span><span class="p">):</span>
        <span class="n">subclass</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">():</span>
                <span class="n">subclass</span> <span class="o">=</span> <span class="n">sc</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keyword</span><span class="p">)</span>

<div class="viewcode-block" id="Hardware.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Hardware.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div></div>

<div class="viewcode-block" id="LinuxHardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware">[docs]</a><span class="k">class</span> <span class="nc">LinuxHardware</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linux-specific subclass of Hardware.  Defines memory and CPU facts:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor (a list)</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>

<span class="sd">    In addition, it also defines number of DMI facts and device facts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Linux&#39;</span>

    <span class="c"># Originally only had these four as toplevelfacts</span>
    <span class="n">ORIGINAL_MEMORY_FACTS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="s">&#39;MemTotal&#39;</span><span class="p">,</span> <span class="s">&#39;SwapTotal&#39;</span><span class="p">,</span> <span class="s">&#39;MemFree&#39;</span><span class="p">,</span> <span class="s">&#39;SwapFree&#39;</span><span class="p">))</span>
    <span class="c"># Now we have all of these in a dict structure</span>
    <span class="n">MEMORY_FACTS</span> <span class="o">=</span> <span class="n">ORIGINAL_MEMORY_FACTS</span><span class="o">.</span><span class="n">union</span><span class="p">((</span><span class="s">&#39;Buffers&#39;</span><span class="p">,</span> <span class="s">&#39;Cached&#39;</span><span class="p">,</span> <span class="s">&#39;SwapCached&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="LinuxHardware.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_dmi_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_device_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_uptime_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_lvm_facts</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_facts</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TimeoutError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="LinuxHardware.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&quot;/proc/meminfo&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">memstats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&quot;/proc/meminfo&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ORIGINAL_MEMORY_FACTS</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_mb&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMORY_FACTS</span><span class="p">:</span>
                 <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                 <span class="n">memstats</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span>

        <span class="k">if</span> <span class="bp">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;memtotal&#39;</span><span class="p">),</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;memfree&#39;</span><span class="p">)):</span>
            <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;real:used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;memtotal&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;memfree&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cached&#39;</span><span class="p">),</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;memfree&#39;</span><span class="p">),</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;buffers&#39;</span><span class="p">)):</span>
            <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;nocache:free&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;cached&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;memfree&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;buffers&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;memtotal&#39;</span><span class="p">),</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nocache:free&#39;</span><span class="p">)):</span>
            <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;nocache:used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;memtotal&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;nocache:free&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;swaptotal&#39;</span><span class="p">),</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;swapfree&#39;</span><span class="p">)):</span>
            <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;swap:used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;swaptotal&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">memstats</span><span class="p">[</span><span class="s">&#39;swapfree&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memory_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                     <span class="s">&#39;real&#39;</span> <span class="p">:</span> <span class="p">{</span>
                         <span class="s">&#39;total&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;memtotal&#39;</span><span class="p">),</span>
                         <span class="s">&#39;used&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;real:used&#39;</span><span class="p">),</span>
                         <span class="s">&#39;free&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;memfree&#39;</span><span class="p">),</span>
                     <span class="p">},</span>
                     <span class="s">&#39;nocache&#39;</span> <span class="p">:</span> <span class="p">{</span>
                         <span class="s">&#39;free&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nocache:free&#39;</span><span class="p">),</span>
                         <span class="s">&#39;used&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nocache:used&#39;</span><span class="p">),</span>
                     <span class="p">},</span>
                     <span class="s">&#39;swap&#39;</span> <span class="p">:</span> <span class="p">{</span>
                         <span class="s">&#39;total&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;swaptotal&#39;</span><span class="p">),</span>
                         <span class="s">&#39;free&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;swapfree&#39;</span><span class="p">),</span>
                         <span class="s">&#39;used&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;swap:used&#39;</span><span class="p">),</span>
                         <span class="s">&#39;cached&#39;</span><span class="p">:</span> <span class="n">memstats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;swapcached&#39;</span><span class="p">),</span>
                     <span class="p">},</span>
                 <span class="p">}</span></div>

<div class="viewcode-block" id="LinuxHardware.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">vendor_id_occurrence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">model_name_occurrence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">physid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">coreid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sockets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">xen</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">xen_paravirt</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/proc/xen&#39;</span><span class="p">):</span>
                <span class="n">xen</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/sys/hypervisor/type&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;xen&#39;</span><span class="p">:</span>
                        <span class="n">xen</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="c"># Only interested in the first line</span>
                    <span class="k">break</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&quot;/proc/cpuinfo&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/proc/cpuinfo&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">xen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;flags&#39;</span><span class="p">:</span>
                    <span class="c"># Check for vme cpu flag, Xen paravirt does not expose this.</span>
                    <span class="c">#   Need to detect Xen paravirt because it exposes cpuinfo</span>
                    <span class="c">#   differently than Xen HVM or KVM and causes reporting of</span>
                    <span class="c">#   only a single cpu core.</span>
                    <span class="k">if</span> <span class="s">&#39;vme&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                        <span class="n">xen_paravirt</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="c"># model name is for Intel arch, Processor (mind the uppercase P)</span>
            <span class="c"># works for some ARM devices, like the Sheevaplug.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;model name&#39;</span><span class="p">,</span> <span class="s">&#39;Processor&#39;</span><span class="p">,</span> <span class="s">&#39;vendor_id&#39;</span><span class="p">,</span> <span class="s">&#39;cpu&#39;</span><span class="p">,</span> <span class="s">&#39;Vendor&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s">&#39;processor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;vendor_id&#39;</span><span class="p">:</span>
                    <span class="n">vendor_id_occurrence</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;model name&#39;</span><span class="p">:</span>
                    <span class="n">model_name_occurrence</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;physical id&#39;</span><span class="p">:</span>
                <span class="n">physid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">physid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                    <span class="n">sockets</span><span class="p">[</span><span class="n">physid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;core id&#39;</span><span class="p">:</span>
                <span class="n">coreid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">coreid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                    <span class="n">cores</span><span class="p">[</span><span class="n">coreid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;cpu cores&#39;</span><span class="p">:</span>
                <span class="n">sockets</span><span class="p">[</span><span class="n">physid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;siblings&#39;</span><span class="p">:</span>
                <span class="n">cores</span><span class="p">[</span><span class="n">coreid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;# processors&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">vendor_id_occurrence</span> <span class="o">==</span> <span class="n">model_name_occurrence</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">vendor_id_occurrence</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;s390x&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xen_paravirt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_threads_per_core&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_vcpus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sockets</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sockets</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="ow">and</span> <span class="n">sockets</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_threads_per_core&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">cores</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="ow">and</span>
                    <span class="n">cores</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_vcpus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_threads_per_core&#39;</span><span class="p">]</span> <span class="o">*</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="LinuxHardware.get_dmi_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_dmi_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_dmi_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; learn dmi facts from system</span>

<span class="sd">        Try /sys first for dmi related facts.</span>
<span class="sd">        If that is not available, fall back to dmidecode executable &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/sys/devices/virtual/dmi/id/product_name&#39;</span><span class="p">):</span>
            <span class="c"># Use kernel DMI info, if available</span>

            <span class="c"># DMI SPEC -- http://www.dmtf.org/sites/default/files/standards/documents/DSP0134_2.7.0.pdf</span>
            <span class="n">FORM_FACTOR</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s">&quot;Other&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s">&quot;Desktop&quot;</span><span class="p">,</span>
                            <span class="s">&quot;Low Profile Desktop&quot;</span><span class="p">,</span> <span class="s">&quot;Pizza Box&quot;</span><span class="p">,</span> <span class="s">&quot;Mini Tower&quot;</span><span class="p">,</span> <span class="s">&quot;Tower&quot;</span><span class="p">,</span>
                            <span class="s">&quot;Portable&quot;</span><span class="p">,</span> <span class="s">&quot;Laptop&quot;</span><span class="p">,</span> <span class="s">&quot;Notebook&quot;</span><span class="p">,</span> <span class="s">&quot;Hand Held&quot;</span><span class="p">,</span> <span class="s">&quot;Docking Station&quot;</span><span class="p">,</span>
                            <span class="s">&quot;All In One&quot;</span><span class="p">,</span> <span class="s">&quot;Sub Notebook&quot;</span><span class="p">,</span> <span class="s">&quot;Space-saving&quot;</span><span class="p">,</span> <span class="s">&quot;Lunch Box&quot;</span><span class="p">,</span>
                            <span class="s">&quot;Main Server Chassis&quot;</span><span class="p">,</span> <span class="s">&quot;Expansion Chassis&quot;</span><span class="p">,</span> <span class="s">&quot;Sub Chassis&quot;</span><span class="p">,</span>
                            <span class="s">&quot;Bus Expansion Chassis&quot;</span><span class="p">,</span> <span class="s">&quot;Peripheral Chassis&quot;</span><span class="p">,</span> <span class="s">&quot;RAID Chassis&quot;</span><span class="p">,</span>
                            <span class="s">&quot;Rack Mount Chassis&quot;</span><span class="p">,</span> <span class="s">&quot;Sealed-case PC&quot;</span><span class="p">,</span> <span class="s">&quot;Multi-system&quot;</span><span class="p">,</span>
                            <span class="s">&quot;CompactPCI&quot;</span><span class="p">,</span> <span class="s">&quot;AdvancedTCA&quot;</span><span class="p">,</span> <span class="s">&quot;Blade&quot;</span> <span class="p">]</span>

            <span class="n">DMI_DICT</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;bios_date&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/bios_date&#39;</span><span class="p">,</span>
                    <span class="s">&#39;bios_version&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/bios_version&#39;</span><span class="p">,</span>
                    <span class="s">&#39;form_factor&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/chassis_type&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_name&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/product_name&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_serial&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/product_serial&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_uuid&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/product_uuid&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_version&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/product_version&#39;</span><span class="p">,</span>
                    <span class="s">&#39;system_vendor&#39;</span><span class="p">:</span> <span class="s">&#39;/sys/devices/virtual/dmi/id/sys_vendor&#39;</span>
                    <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">path</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DMI_DICT</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;form_factor&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;form_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FORM_FACTOR</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;form_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">data</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Fall back to using dmidecode, if available</span>
            <span class="n">dmi_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;dmidecode&#39;</span><span class="p">)</span>
            <span class="n">DMI_DICT</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;bios_date&#39;</span><span class="p">:</span> <span class="s">&#39;bios-release-date&#39;</span><span class="p">,</span>
                    <span class="s">&#39;bios_version&#39;</span><span class="p">:</span> <span class="s">&#39;bios-version&#39;</span><span class="p">,</span>
                    <span class="s">&#39;form_factor&#39;</span><span class="p">:</span> <span class="s">&#39;chassis-type&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_name&#39;</span><span class="p">:</span> <span class="s">&#39;system-product-name&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_serial&#39;</span><span class="p">:</span> <span class="s">&#39;system-serial-number&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_uuid&#39;</span><span class="p">:</span> <span class="s">&#39;system-uuid&#39;</span><span class="p">,</span>
                    <span class="s">&#39;product_version&#39;</span><span class="p">:</span> <span class="s">&#39;system-version&#39;</span><span class="p">,</span>
                    <span class="s">&#39;system_vendor&#39;</span><span class="p">:</span> <span class="s">&#39;system-manufacturer&#39;</span>
                    <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DMI_DICT</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">dmi_bin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> -s </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dmi_bin</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c"># Strip out commented lines (specific dmidecode output)</span>
                        <span class="n">thisvalue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="p">])</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">thisvalue</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                            <span class="n">thisvalue</span> <span class="o">=</span> <span class="s">&quot;NA&quot;</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisvalue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span></div>

    <span class="nd">@timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="LinuxHardware.get_mount_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_mount_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_mount_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uuids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bind_mounts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">findmntPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&quot;findmnt&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">findmntPath</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> -lnur&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">findmntPath</span> <span class="p">),</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># find bind mounts, in case /etc/mtab is a symlink to /proc/mounts</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;.*\]&quot;</span><span class="p">,</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">bind_mounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">mtab</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/mtab&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mtab</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;:/&#39;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;none&#39;</span><span class="p">):</span>
                    <span class="n">size_total</span><span class="p">,</span> <span class="n">size_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mount_size_facts</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">uuids</span><span class="p">:</span>
                        <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuids</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">uuid</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
                        <span class="n">lsblkPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&quot;lsblk&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lsblkPath</span><span class="p">:</span>
                            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> -ln --output UUID </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lsblkPath</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">uuid</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="n">uuids</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">uuid</span>

                    <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bind_mounts</span><span class="p">:</span>
                        <span class="c"># only add if not already there, we might have a plain /etc/mtab</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;.*bind.*&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                            <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&quot;,bind&quot;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s">&#39;mount&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="s">&#39;device&#39;</span><span class="p">:</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="s">&#39;fstype&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                         <span class="s">&#39;options&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                         <span class="c"># statvfs data</span>
                         <span class="s">&#39;size_total&#39;</span><span class="p">:</span> <span class="n">size_total</span><span class="p">,</span>
                         <span class="s">&#39;size_available&#39;</span><span class="p">:</span> <span class="n">size_available</span><span class="p">,</span>
                         <span class="s">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
                         <span class="p">})</span></div>

<div class="viewcode-block" id="LinuxHardware.get_device_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_device_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;devices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lspci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;lspci&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lspci</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">pcidata</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">lspci</span><span class="p">,</span> <span class="s">&#39;-D&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pcidata</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_devs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&quot;/sys/block&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">block_devs</span><span class="p">:</span>
            <span class="n">virtual</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">sysfs_no_links</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;/sys/block/&quot;</span><span class="p">,</span> <span class="n">block</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EINVAL</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">block</span>
                    <span class="n">sysfs_no_links</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="s">&quot;virtual&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sysdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;/sys/block&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sysfs_no_links</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sysdir</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s">&quot;device&quot;</span> <span class="ow">in</span> <span class="n">folder</span><span class="p">:</span>
                        <span class="n">virtual</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">virtual</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">diskname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sysdir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;vendor&#39;</span><span class="p">,</span> <span class="s">&#39;model&#39;</span><span class="p">,</span> <span class="s">&#39;sas_address&#39;</span><span class="p">,</span> <span class="s">&#39;sas_device_handle&#39;</span><span class="p">]:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/device/&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">test</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="s">&#39;removable&#39;</span><span class="p">,</span><span class="s">&#39;/removable&#39;</span><span class="p">),</span> \
                              <span class="p">(</span><span class="s">&#39;support_discard&#39;</span><span class="p">,</span><span class="s">&#39;/queue/discard_granularity&#39;</span><span class="p">),</span>
                              <span class="p">]:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="n">test</span><span class="p">)</span>

            <span class="n">d</span><span class="p">[</span><span class="s">&#39;partitions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sysdir</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="n">diskname</span> <span class="o">+</span> <span class="s">&quot;\d+)&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">partname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">part_sysdir</span> <span class="o">=</span> <span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">partname</span>

                    <span class="n">part</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">part_sysdir</span> <span class="o">+</span> <span class="s">&quot;/start&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">part</span><span class="p">[</span><span class="s">&#39;sectors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">part_sysdir</span> <span class="o">+</span> <span class="s">&quot;/size&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">part</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">part_sysdir</span> <span class="o">+</span> <span class="s">&quot;/queue/logical_block_size&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]:</span>
                        <span class="n">part</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">part_sysdir</span> <span class="o">+</span> <span class="s">&quot;/queue/hw_sector_size&quot;</span><span class="p">,</span><span class="mi">512</span><span class="p">)</span>
                    <span class="n">part</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pretty_bytes</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="s">&#39;sectors&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">])))</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;partitions&#39;</span><span class="p">][</span><span class="n">partname</span><span class="p">]</span> <span class="o">=</span> <span class="n">part</span>

            <span class="n">d</span><span class="p">[</span><span class="s">&#39;rotational&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/queue/rotational&quot;</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;scheduler_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">scheduler</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/queue/scheduler&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;.*?(\[(.*)\])&quot;</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;scheduler_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">d</span><span class="p">[</span><span class="s">&#39;sectors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/size&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;sectors&#39;</span><span class="p">]:</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;sectors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/queue/logical_block_size&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]:</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/queue/hw_sector_size&quot;</span><span class="p">,</span><span class="mi">512</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pretty_bytes</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;sectors&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;sectorsize&#39;</span><span class="p">]))</span>

            <span class="n">d</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

            <span class="c"># domains are numbered (0 to ffff), bus (0 to ff), slot (0 to 1f), and function (0 to 7).</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;.+/([a-f0-9]{4}:[a-f0-9]{2}:[0|1][a-f0-9]\.[0-7])/&quot;</span><span class="p">,</span> <span class="n">sysdir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">and</span> <span class="n">pcidata</span><span class="p">:</span>
                <span class="n">pciid</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">did</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">pciid</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^&quot;</span> <span class="o">+</span> <span class="n">did</span> <span class="o">+</span> <span class="s">&quot;\s(.*)$&quot;</span><span class="p">,</span> <span class="n">pcidata</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">d</span><span class="p">[</span><span class="s">&#39;holders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/holders&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/holders&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;dm-&quot;</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">sysdir</span> <span class="o">+</span> <span class="s">&quot;/holders/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s">&quot;/dm/name&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">d</span><span class="p">[</span><span class="s">&#39;holders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">d</span><span class="p">[</span><span class="s">&#39;holders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;devices&#39;</span><span class="p">][</span><span class="n">diskname</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span></div>

<div class="viewcode-block" id="LinuxHardware.get_uptime_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_uptime_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_uptime_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uptime_file_content</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/proc/uptime&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uptime_file_content</span><span class="p">:</span>
            <span class="n">uptime_seconds_string</span> <span class="o">=</span> <span class="n">uptime_file_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;uptime_seconds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">uptime_seconds_string</span><span class="p">))</span></div>

<div class="viewcode-block" id="LinuxHardware.get_lvm_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxHardware.get_lvm_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_lvm_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get LVM Facts if running as root and lvm utils are available &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;vgs&#39;</span><span class="p">):</span>
            <span class="n">lvm_util_options</span> <span class="o">=</span> <span class="s">&#39;--noheadings --nosuffix --units g&#39;</span>

            <span class="n">vgs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;vgs&#39;</span><span class="p">)</span>
            <span class="c">#vgs fields: VG #PV #LV #SN Attr VSize VFree</span>
            <span class="n">vgs</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">if</span> <span class="n">vgs_path</span><span class="p">:</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">vg_lines</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vgs_path</span><span class="p">,</span> <span class="n">lvm_util_options</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">vg_line</span> <span class="ow">in</span> <span class="n">vg_lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="n">vg_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">vgs</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;size_g&#39;</span><span class="p">:</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>
                                     <span class="s">&#39;free_g&#39;</span><span class="p">:</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="s">&#39;num_lvs&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                     <span class="s">&#39;num_pvs&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>

            <span class="n">lvs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;lvs&#39;</span><span class="p">)</span>
            <span class="c">#lvs fields:</span>
            <span class="c">#LV VG Attr LSize Pool Origin Data% Move Log Copy% Convert</span>
            <span class="n">lvs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">lvs_path</span><span class="p">:</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">lv_lines</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lvs_path</span><span class="p">,</span> <span class="n">lvm_util_options</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">lv_line</span> <span class="ow">in</span> <span class="n">lv_lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="n">lv_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">lvs</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;size_g&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;vg&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;lvm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;lvs&#39;</span><span class="p">:</span> <span class="n">lvs</span><span class="p">,</span> <span class="s">&#39;vgs&#39;</span><span class="p">:</span> <span class="n">vgs</span><span class="p">}</span></div></div>


<div class="viewcode-block" id="SunOSHardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSHardware">[docs]</a><span class="k">class</span> <span class="nc">SunOSHardware</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    In addition to the generic memory and cpu facts, this also sets</span>
<span class="sd">    swap_reserved_mb and swap_allocated_mb that is available from *swap -s*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;SunOS&#39;</span>

<div class="viewcode-block" id="SunOSHardware.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSHardware.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_facts</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TimeoutError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="SunOSHardware.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSHardware.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">physid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sockets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/kstat cpu_info&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c"># &quot;brand&quot; works on Solaris 10 &amp; 11. &quot;implementation&quot; for Solaris 9.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;module:&#39;</span><span class="p">:</span>
                <span class="n">brand</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;brand&#39;</span><span class="p">:</span>
                <span class="n">brand</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;clock_MHz&#39;</span><span class="p">:</span>
                <span class="n">clock_mhz</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;implementation&#39;</span><span class="p">:</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="n">brand</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c"># Add clock speed to description for SPARC CPU</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;machine&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;i86pc&#39;</span><span class="p">:</span>
                    <span class="n">processor</span> <span class="o">+=</span> <span class="s">&quot; @ &quot;</span> <span class="o">+</span> <span class="n">clock_mhz</span> <span class="o">+</span> <span class="s">&quot;MHz&quot;</span>
                <span class="k">if</span> <span class="s">&#39;processor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;chip_id&#39;</span><span class="p">:</span>
                <span class="n">physid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">physid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                    <span class="n">sockets</span><span class="p">[</span><span class="n">physid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sockets</span><span class="p">[</span><span class="n">physid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># Counting cores on Solaris can be complicated.</span>
        <span class="c"># https://blogs.oracle.com/mandalika/entry/solaris_show_me_the_cpu</span>
        <span class="c"># Treat &#39;processor_count&#39; as physical sockets and &#39;processor_cores&#39; as</span>
        <span class="c"># virtual CPUs visisble to Solaris. Not a true count of cores for modern SPARC as</span>
        <span class="c"># these processors have: sockets -&gt; cores -&gt; threads/virtual CPU.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">sockets</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="SunOSHardware.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSHardware.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="s">&quot;/usr/sbin/prtconf&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;Memory size&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/swap -s&quot;</span><span class="p">)</span>
        <span class="n">allocated</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">reserved</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">used</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">free</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">10</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swapfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swaptotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">free</span> <span class="o">+</span> <span class="n">used</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swap_allocated_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allocated</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swap_reserved_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reserved</span> <span class="o">/</span> <span class="mi">1024</span></div>

    <span class="nd">@timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="SunOSHardware.get_mount_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSHardware.get_mount_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_mount_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># For a detailed format description see mnttab(4)</span>
        <span class="c">#   special mount_point fstype options time</span>
        <span class="n">fstab</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/mnttab&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fstab</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fstab</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">size_total</span><span class="p">,</span> <span class="n">size_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mount_size_facts</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;mount&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;fstype&#39;</span> <span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;options&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s">&#39;size_total&#39;</span><span class="p">:</span> <span class="n">size_total</span><span class="p">,</span> <span class="s">&#39;size_available&#39;</span><span class="p">:</span> <span class="n">size_available</span><span class="p">})</span></div></div>


<div class="viewcode-block" id="OpenBSDHardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware">[docs]</a><span class="k">class</span> <span class="nc">OpenBSDHardware</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OpenBSD-specific subclass of Hardware. Defines memory, CPU and device facts:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor (a list)</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>
<span class="sd">    - processor_speed</span>
<span class="sd">    - devices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;OpenBSD&#39;</span>
    <span class="n">DMESG_BOOT</span> <span class="o">=</span> <span class="s">&#39;/var/run/dmesg.boot&#39;</span>

<div class="viewcode-block" id="OpenBSDHardware.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sysctl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_processor_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_device_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="OpenBSDHardware.get_sysctl"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware.get_sysctl">[docs]</a>    <span class="k">def</span> <span class="nf">get_sysctl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="s">&quot;/sbin/sysctl&quot;</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sysctl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">sysctl</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">sysctl</span></div>

    <span class="nd">@timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="OpenBSDHardware.get_mount_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware.get_mount_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_mount_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fstab</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/fstab&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fstab</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fstab</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span> <span class="ow">or</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;xx&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">size_total</span><span class="p">,</span> <span class="n">size_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mount_size_facts</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;mount&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;fstype&#39;</span> <span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;options&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;size_total&#39;</span><span class="p">:</span> <span class="n">size_total</span><span class="p">,</span> <span class="s">&#39;size_available&#39;</span><span class="p">:</span> <span class="n">size_available</span><span class="p">})</span></div>


<div class="viewcode-block" id="OpenBSDHardware.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get free memory. vmstat output looks like:</span>
        <span class="c">#  procs    memory       page                    disks    traps          cpu</span>
        <span class="c">#  r b w    avm     fre  flt  re  pi  po  fr  sr wd0 fd0  int   sys   cs us sy id</span>
        <span class="c">#  0 0 0  47512   28160   51   0   0   0   0   0   1   0  116    89   17  0  1 99</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/vmstat&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;hw.usermem&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>

        <span class="c"># Get swapctl info. swapctl output looks like:</span>
        <span class="c"># total: 69268 1K-blocks allocated, 0 used, 69268 available</span>
        <span class="c"># And for older OpenBSD:</span>
        <span class="c"># total: 69268k bytes allocated = 0k used, 69268k available</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/sbin/swapctl -sk&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">swaptrans</span> <span class="o">=</span> <span class="n">maketrans</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swapfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">swaptrans</span><span class="p">,</span> <span class="s">&quot;kmg&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1024</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swaptotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">swaptrans</span><span class="p">,</span> <span class="s">&quot;kmg&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1024</span></div>

<div class="viewcode-block" id="OpenBSDHardware.get_processor_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware.get_processor_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_processor_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dmesg_boot</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">OpenBSDHardware</span><span class="o">.</span><span class="n">DMESG_BOOT</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dmesg_boot</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">dmesg_boot</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/sbin/dmesg&quot;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">dmesg_boot</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;cpu</span><span class="si">%i</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">processor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">processor_count</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processor_count</span>
        <span class="c"># I found no way to figure out the number of Cores per CPU in OpenBSD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span></div>

<div class="viewcode-block" id="OpenBSDHardware.get_device_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDHardware.get_device_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;hw.disknames&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;devices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">devices</span></div></div>

<div class="viewcode-block" id="FreeBSDHardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware">[docs]</a><span class="k">class</span> <span class="nc">FreeBSDHardware</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FreeBSD-specific subclass of Hardware.  Defines memory and CPU facts:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor (a list)</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>
<span class="sd">    - devices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;FreeBSD&#39;</span>
    <span class="n">DMESG_BOOT</span> <span class="o">=</span> <span class="s">&#39;/var/run/dmesg.boot&#39;</span>

<div class="viewcode-block" id="FreeBSDHardware.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_dmi_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_device_facts</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_facts</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TimeoutError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="FreeBSDHardware.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/sbin/sysctl -n hw.ncpu&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">dmesg_boot</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">FreeBSDHardware</span><span class="o">.</span><span class="n">DMESG_BOOT</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dmesg_boot</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">dmesg_boot</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/sbin/dmesg&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">dmesg_boot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;CPU:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">cpu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;CPU:\s+&#39;</span><span class="p">,</span> <span class="s">r&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cpu</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="s">&#39;Logical CPUs per core&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span></div>


<div class="viewcode-block" id="FreeBSDHardware.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/sbin/sysctl vm.stats&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&#39;vm.stats.vm.v_page_size&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">pagesize</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;vm.stats.vm.v_page_count&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">pagecount</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;vm.stats.vm.v_free_count&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">freecount</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagesize</span> <span class="o">*</span> <span class="n">pagecount</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagesize</span> <span class="o">*</span> <span class="n">freecount</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="c"># Get swapinfo.  swapinfo output looks like:</span>
        <span class="c"># Device          1M-blocks     Used    Avail Capacity</span>
        <span class="c"># /dev/ada0p3        314368        0   314368     0%</span>
        <span class="c">#</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/swapinfo -k&quot;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;Device&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swaptotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swapfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span></div>

    <span class="nd">@timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="FreeBSDHardware.get_mount_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware.get_mount_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_mount_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fstab</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/fstab&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fstab</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fstab</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">size_total</span><span class="p">,</span> <span class="n">size_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mount_size_facts</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;mount&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;fstype&#39;</span> <span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;options&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;size_total&#39;</span><span class="p">:</span> <span class="n">size_total</span><span class="p">,</span> <span class="s">&#39;size_available&#39;</span><span class="p">:</span> <span class="n">size_available</span><span class="p">})</span></div>

<div class="viewcode-block" id="FreeBSDHardware.get_device_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware.get_device_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sysdir</span> <span class="o">=</span> <span class="s">&#39;/dev&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;devices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">drives</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;(ada?\d+|da\d+|a?cd\d+)&#39;</span><span class="p">)</span> <span class="c">#TODO: rc, disks, err = self.module.run_command(&quot;/sbin/sysctl kern.disks&quot;)</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;(ada?\d+s\d+\w*|da\d+s\d+\w*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sysdir</span><span class="p">):</span>
            <span class="n">dirlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sysdir</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">dirlist</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">drives</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;devices&#39;</span><span class="p">][</span><span class="n">d</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">slices</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;devices&#39;</span><span class="p">][</span><span class="n">d</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="FreeBSDHardware.get_dmi_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDHardware.get_dmi_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_dmi_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; learn dmi facts from system</span>

<span class="sd">        Use dmidecode executable if available&#39;&#39;&#39;</span>

        <span class="c"># Fall back to using dmidecode, if available</span>
        <span class="n">dmi_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;dmidecode&#39;</span><span class="p">)</span>
        <span class="n">DMI_DICT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">bios_date</span><span class="o">=</span><span class="s">&#39;bios-release-date&#39;</span><span class="p">,</span>
            <span class="n">bios_version</span><span class="o">=</span><span class="s">&#39;bios-version&#39;</span><span class="p">,</span>
            <span class="n">form_factor</span><span class="o">=</span><span class="s">&#39;chassis-type&#39;</span><span class="p">,</span>
            <span class="n">product_name</span><span class="o">=</span><span class="s">&#39;system-product-name&#39;</span><span class="p">,</span>
            <span class="n">product_serial</span><span class="o">=</span><span class="s">&#39;system-serial-number&#39;</span><span class="p">,</span>
            <span class="n">product_uuid</span><span class="o">=</span><span class="s">&#39;system-uuid&#39;</span><span class="p">,</span>
            <span class="n">product_version</span><span class="o">=</span><span class="s">&#39;system-version&#39;</span><span class="p">,</span>
            <span class="n">system_vendor</span><span class="o">=</span><span class="s">&#39;system-manufacturer&#39;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DMI_DICT</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dmi_bin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> -s </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dmi_bin</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># Strip out commented lines (specific dmidecode output)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="p">])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span></div></div>

<div class="viewcode-block" id="DragonFlyHardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.DragonFlyHardware">[docs]</a><span class="k">class</span> <span class="nc">DragonFlyHardware</span><span class="p">(</span><span class="n">FreeBSDHardware</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="NetBSDHardware"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.NetBSDHardware">[docs]</a><span class="k">class</span> <span class="nc">NetBSDHardware</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NetBSD-specific subclass of Hardware.  Defines memory and CPU facts:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor (a list)</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>
<span class="sd">    - devices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;NetBSD&#39;</span>
    <span class="n">MEMORY_FACTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;MemTotal&#39;</span><span class="p">,</span> <span class="s">&#39;SwapTotal&#39;</span><span class="p">,</span> <span class="s">&#39;MemFree&#39;</span><span class="p">,</span> <span class="s">&#39;SwapFree&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="NetBSDHardware.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.NetBSDHardware.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_facts</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TimeoutError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="NetBSDHardware.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.NetBSDHardware.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">physid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sockets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&quot;/proc/cpuinfo&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&quot;/proc/cpuinfo&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c"># model name is for Intel arch, Processor (mind the uppercase P)</span>
            <span class="c"># works for some ARM devices, like the Sheevaplug.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;model name&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;Processor&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;processor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;physical id&#39;</span><span class="p">:</span>
                <span class="n">physid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">physid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                    <span class="n">sockets</span><span class="p">[</span><span class="n">physid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;cpu cores&#39;</span><span class="p">:</span>
                <span class="n">sockets</span><span class="p">[</span><span class="n">physid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">sockets</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span></div>

<div class="viewcode-block" id="NetBSDHardware.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.NetBSDHardware.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&quot;/proc/meminfo&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&quot;/proc/meminfo&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">NetBSDHardware</span><span class="o">.</span><span class="n">MEMORY_FACTS</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_mb&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span></div>

    <span class="nd">@timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="NetBSDHardware.get_mount_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.NetBSDHardware.get_mount_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_mount_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fstab</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/etc/fstab&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fstab</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fstab</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">size_total</span><span class="p">,</span> <span class="n">size_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mount_size_facts</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;mounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;mount&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;fstype&#39;</span> <span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;options&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;size_total&#39;</span><span class="p">:</span> <span class="n">size_total</span><span class="p">,</span> <span class="s">&#39;size_available&#39;</span><span class="p">:</span> <span class="n">size_available</span><span class="p">})</span></div></div>

<div class="viewcode-block" id="AIX"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIX">[docs]</a><span class="k">class</span> <span class="nc">AIX</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AIX-specific subclass of Hardware.  Defines memory and CPU facts:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor (a list)</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;AIX&#39;</span>

<div class="viewcode-block" id="AIX.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIX.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_dmi_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="AIX.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIX.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/lsdev -Cc processor&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>

                <span class="k">if</span> <span class="s">&#39;Available&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">cpudev</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/lsattr -El &quot;</span> <span class="o">+</span> <span class="n">cpudev</span> <span class="o">+</span> <span class="s">&quot; -a type&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/lsattr -El &quot;</span> <span class="o">+</span> <span class="n">cpudev</span> <span class="o">+</span> <span class="s">&quot; -a smt_threads&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="AIX.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIX.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pagesize</span> <span class="o">=</span> <span class="mi">4096</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/vmstat -v&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&#39;memory pages&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">pagecount</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;free pages&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">freecount</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagesize</span> <span class="o">*</span> <span class="n">pagecount</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagesize</span> <span class="o">*</span> <span class="n">freecount</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="c"># Get swapinfo.  swapinfo output looks like:</span>
        <span class="c"># Device          1M-blocks     Used    Avail Capacity</span>
        <span class="c"># /dev/ada0p3        314368        0   314368     0%</span>
        <span class="c">#</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/lsps -s&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">swaptotal_mb</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;MB&#39;</span><span class="p">))</span>
            <span class="n">percused</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;%&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swaptotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swaptotal_mb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swapfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">swaptotal_mb</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">percused</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span></div>

<div class="viewcode-block" id="AIX.get_dmi_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIX.get_dmi_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_dmi_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/lsattr -El sys0 -a fwversion&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;IBM,&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="HPUX"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUX">[docs]</a><span class="k">class</span> <span class="nc">HPUX</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HP-UX-specific subclass of Hardware. Defines memory and CPU facts:</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - swapfree_mb</span>
<span class="sd">    - swaptotal_mb</span>
<span class="sd">    - processor</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - processor_count</span>
<span class="sd">    - model</span>
<span class="sd">    - firmware</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;HP-UX&#39;</span>

<div class="viewcode-block" id="HPUX.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUX.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_hw_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="HPUX.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUX.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;9000/800&#39;</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;ioscan -FkCprocessor | wc -l&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="c">#Working with machinfo mess</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ia64&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;B.11.23&quot;</span><span class="p">:</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep &#39;Number of CPUs&#39;&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep &#39;processor family&#39;&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;.*(Intel.*)&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;ioscan -FkCprocessor | wc -l&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;B.11.31&quot;</span><span class="p">:</span>
                <span class="c">#if machinfo return cores strings release B.11.31 &gt; 1204</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep core | wc -l&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep Intel&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c">#If hyperthreading is active divide cores by 2</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/psrset | grep LCPU&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; +&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">hyperthreading</span> <span class="o">=</span> <span class="s">&#39;OFF&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hyperthreading</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep logical&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hyperthreading</span> <span class="o">==</span> <span class="s">&#39;ON&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep Intel |cut -d&#39; &#39; -f4-&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | egrep &#39;socket[s]?$&#39; | tail -1&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep -e &#39;[0-9] core&#39; | tail -1&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep Intel&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="HPUX.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUX.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pagesize</span> <span class="o">=</span> <span class="mi">4096</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/vmstat | tail -1&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; +&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagesize</span> <span class="o">*</span> <span class="n">data</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;9000/800&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;grep Physical /var/adm/syslog/syslog.log&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;.*Physical: ([0-9]*) Kbytes.*&#39;</span><span class="p">,</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c">#For systems where memory details aren&#39;t sent to syslog or the log has rotated, use parsed</span>
                <span class="c">#adb output. Unfortunately /dev/kmem doesn&#39;t have world-read, so this only works as root.</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&quot;/dev/kmem&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;echo &#39;phys_mem_pages/D&#39; | adb -k /stand/vmunix /dev/kmem | tail -1 | awk &#39;{print $2}&#39;&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">err</span><span class="p">:</span>
                      <span class="n">data</span> <span class="o">=</span> <span class="n">out</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">256</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo | grep Memory&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;Memory[\ :=]*([0-9]*).*MB.*&#39;</span><span class="p">,</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/swapinfo -m -d -f -q&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swaptotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/swapinfo -m -d -f | egrep &#39;^dev|^fs&#39;&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">swap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">swap</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; +&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;swapfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swap</span></div>

<div class="viewcode-block" id="HPUX.get_hw_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUX.get_hw_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_hw_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ia64&#39;</span><span class="p">:</span>
            <span class="n">separator</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;B.11.23&quot;</span><span class="p">:</span>
                <span class="n">separator</span> <span class="o">=</span> <span class="s">&#39;=&#39;</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/contrib/bin/machinfo |grep -i &#39;Firmware revision&#39; | grep -v BMC&quot;</span><span class="p">,</span> <span class="n">use_unsafe_shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Darwin"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin">[docs]</a><span class="k">class</span> <span class="nc">Darwin</span><span class="p">(</span><span class="n">Hardware</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Darwin-specific subclass of Hardware.  Defines memory and CPU facts:</span>
<span class="sd">    - processor</span>
<span class="sd">    - processor_cores</span>
<span class="sd">    - memtotal_mb</span>
<span class="sd">    - memfree_mb</span>
<span class="sd">    - model</span>
<span class="sd">    - osversion</span>
<span class="sd">    - osrevision</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Darwin&#39;</span>

<div class="viewcode-block" id="Darwin.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sysctl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_mac_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_facts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="Darwin.get_sysctl"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin.get_sysctl">[docs]</a>    <span class="k">def</span> <span class="nf">get_sysctl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="s">&quot;/usr/sbin/sysctl&quot;</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;machdep&quot;</span><span class="p">,</span> <span class="s">&quot;kern&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sysctl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; = |: &#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">sysctl</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">sysctl</span></div>

<div class="viewcode-block" id="Darwin.get_system_profile"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin.get_system_profile">[docs]</a>    <span class="k">def</span> <span class="nf">get_system_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="s">&quot;/usr/sbin/system_profiler&quot;</span><span class="p">,</span> <span class="s">&quot;SPHardwareDataType&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">system_profile</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="s">&#39;: &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">system_profile</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">system_profile</span></div>

<div class="viewcode-block" id="Darwin.get_mac_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin.get_mac_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_mac_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;sysctl hw.model&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;osversion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;kern.osversion&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;osrevision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;kern.osrevision&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Darwin.get_cpu_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin.get_cpu_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;machdep.cpu.brand_string&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">:</span> <span class="c"># Intel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;machdep.cpu.brand_string&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;machdep.cpu.core_count&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># PowerPC</span>
            <span class="n">system_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_profile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> @ </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">system_profile</span><span class="p">[</span><span class="s">&#39;Processor Name&#39;</span><span class="p">],</span> <span class="n">system_profile</span><span class="p">[</span><span class="s">&#39;Processor Speed&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;processor_cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;hw.physicalcpu&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Darwin.get_memory_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Darwin.get_memory_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_memory_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memtotal_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysctl</span><span class="p">[</span><span class="s">&#39;hw.memsize&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>

        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;sysctl hw.usermem&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;memfree_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span></div></div>


<div class="viewcode-block" id="Network"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Network">[docs]</a><span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="n">Facts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a generic Network subclass of Facts.  This should be further</span>
<span class="sd">    subclassed to implement per platform.  If you subclass this,</span>
<span class="sd">    you must define:</span>
<span class="sd">    - interfaces (a list of interface names)</span>
<span class="sd">    - interface_&lt;name&gt; dictionary of ipv4, ipv6, and mac address information.</span>

<span class="sd">    All subclasses MUST define platform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Generic&#39;</span>

    <span class="n">IPV6_SCOPE</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;0&#39;</span> <span class="p">:</span> <span class="s">&#39;global&#39;</span><span class="p">,</span>
                   <span class="s">&#39;10&#39;</span> <span class="p">:</span> <span class="s">&#39;host&#39;</span><span class="p">,</span>
                   <span class="s">&#39;20&#39;</span> <span class="p">:</span> <span class="s">&#39;link&#39;</span><span class="p">,</span>
                   <span class="s">&#39;40&#39;</span> <span class="p">:</span> <span class="s">&#39;admin&#39;</span><span class="p">,</span>
                   <span class="s">&#39;50&#39;</span> <span class="p">:</span> <span class="s">&#39;site&#39;</span><span class="p">,</span>
                   <span class="s">&#39;80&#39;</span> <span class="p">:</span> <span class="s">&#39;organization&#39;</span> <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keyword</span><span class="p">):</span>
        <span class="n">subclass</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span><span class="n">Network</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">():</span>
                <span class="n">subclass</span> <span class="o">=</span> <span class="n">sc</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keyword</span><span class="p">)</span>

<div class="viewcode-block" id="Network.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Network.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div></div>

<div class="viewcode-block" id="LinuxNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxNetwork">[docs]</a><span class="k">class</span> <span class="nc">LinuxNetwork</span><span class="p">(</span><span class="n">Network</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a Linux-specific subclass of Network.  It defines</span>
<span class="sd">    - interfaces (a list of interface names)</span>
<span class="sd">    - interface_&lt;name&gt; dictionary of ipv4, ipv6, and mac address information.</span>
<span class="sd">    - all_ipv4_addresses and all_ipv6_addresses: lists of all configured addresses.</span>
<span class="sd">    - ipv4_address and ipv6_address: the first non-local address for each family.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Linux&#39;</span>

<div class="viewcode-block" id="LinuxNetwork.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxNetwork.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ip_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;ip&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ip_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span>
        <span class="n">default_ipv4</span><span class="p">,</span> <span class="n">default_ipv6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_interfaces</span><span class="p">(</span><span class="n">ip_path</span><span class="p">)</span>
        <span class="n">interfaces</span><span class="p">,</span> <span class="n">ips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interfaces_info</span><span class="p">(</span><span class="n">ip_path</span><span class="p">,</span> <span class="n">default_ipv4</span><span class="p">,</span> <span class="n">default_ipv6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;default_ipv4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_ipv4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;default_ipv6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_ipv6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;all_ipv4_addresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv4_addresses&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;all_ipv6_addresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv6_addresses&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="LinuxNetwork.get_default_interfaces"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxNetwork.get_default_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_path</span><span class="p">):</span>
        <span class="c"># Use the commands:</span>
        <span class="c">#     ip -4 route get 8.8.8.8                     -&gt; Google public DNS</span>
        <span class="c">#     ip -6 route get 2404:6800:400a:800::1012    -&gt; ipv6.google.com</span>
        <span class="c"># to find out the default outgoing interface, address, and gateway</span>
        <span class="n">command</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">v4</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip_path</span><span class="p">,</span> <span class="s">&#39;-4&#39;</span><span class="p">,</span> <span class="s">&#39;route&#39;</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;8.8.8.8&#39;</span><span class="p">],</span>
            <span class="n">v6</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip_path</span><span class="p">,</span> <span class="s">&#39;-6&#39;</span><span class="p">,</span> <span class="s">&#39;route&#39;</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;2404:6800:400a:800::1012&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">v4</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">v6</span> <span class="o">=</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="s">&#39;v4&#39;</span><span class="p">,</span> <span class="s">&#39;v6&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;v6&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;os_family&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;RedHat&#39;</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;distribution_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;4.&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;v6&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">socket</span><span class="o">.</span><span class="n">has_ipv6</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
                <span class="c"># v6 routing may result in</span>
                <span class="c">#   RTNETLINK answers: Invalid argument</span>
                <span class="k">continue</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c"># A valid output starts with the queried address on the first line</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">command</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;dev&#39;</span><span class="p">:</span>
                        <span class="n">interface</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;src&#39;</span><span class="p">:</span>
                        <span class="n">interface</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;via&#39;</span> <span class="ow">and</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">command</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">interface</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;gateway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v4&#39;</span><span class="p">],</span> <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v6&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="LinuxNetwork.get_interfaces_info"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxNetwork.get_interfaces_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_path</span><span class="p">,</span> <span class="n">default_ipv4</span><span class="p">,</span> <span class="n">default_ipv6</span><span class="p">):</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ips</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">all_ipv4_addresses</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">all_ipv6_addresses</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;/sys/class/net/*&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span> <span class="p">}</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;address&#39;</span><span class="p">)):</span>
                <span class="n">macaddress</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;address&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">macaddress</span> <span class="ow">and</span> <span class="n">macaddress</span> <span class="o">!=</span> <span class="s">&#39;00:00:00:00:00:00&#39;</span><span class="p">:</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macaddress</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;mtu&#39;</span><span class="p">)):</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;mtu&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;operstate&#39;</span><span class="p">)):</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;active&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;operstate&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="s">&#39;down&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;device&#39;</span><span class="p">,</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="s">&#39;module&#39;</span><span class="p">)):</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;device&#39;</span><span class="p">,</span> <span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="s">&#39;module&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)):</span>
                <span class="n">_type</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">_type</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ether&#39;</span>
                <span class="k">elif</span> <span class="n">_type</span> <span class="o">==</span> <span class="s">&#39;512&#39;</span><span class="p">:</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ppp&#39;</span>
                <span class="k">elif</span> <span class="n">_type</span> <span class="o">==</span> <span class="s">&#39;772&#39;</span><span class="p">:</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;loopback&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bridge&#39;</span><span class="p">)):</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bridge&#39;</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;brif&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">))</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bridge&#39;</span><span class="p">,</span> <span class="s">&#39;bridge_id&#39;</span><span class="p">)):</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bridge&#39;</span><span class="p">,</span> <span class="s">&#39;bridge_id&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bridge&#39;</span><span class="p">,</span> <span class="s">&#39;stp_state&#39;</span><span class="p">)):</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;stp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bridge&#39;</span><span class="p">,</span> <span class="s">&#39;stp_state&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">)):</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bonding&#39;</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">,</span> <span class="s">&#39;slaves&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">,</span> <span class="s">&#39;mode&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;miimon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">,</span> <span class="s">&#39;miimon&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;lacp_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">,</span> <span class="s">&#39;lacp_rate&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">primary</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">,</span> <span class="s">&#39;primary&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;primary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primary</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bonding&#39;</span><span class="p">,</span> <span class="s">&#39;all_slaves_active&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;all_slaves_active&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;device&#39;</span><span class="p">)):</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;pciid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;device&#39;</span><span class="p">)))</span>

            <span class="c"># Check whether an interface is in promiscuous mode</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;flags&#39;</span><span class="p">)):</span>
                <span class="n">promisc_mode</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="c"># The second byte indicates whether the interface is in promiscuous mode.</span>
                <span class="c"># 1 = promisc</span>
                <span class="c"># 0 = no promisc</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;flags&#39;</span><span class="p">)),</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">promisc_mode</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0x0100</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;promisc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">promisc_mode</span>

            <span class="k">def</span> <span class="nf">parse_ip_output</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">broadcast</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">address</span><span class="p">,</span> <span class="n">netmask_length</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="n">broadcast</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c"># pointopoint interfaces do not have a prefix</span>
                            <span class="n">address</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">netmask_length</span> <span class="o">=</span> <span class="s">&quot;32&quot;</span>
                        <span class="n">address_bin</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">address</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">netmask_bin</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="o">&gt;&gt;</span><span class="nb">int</span><span class="p">(</span><span class="n">netmask_length</span><span class="p">))</span>
                        <span class="n">netmask</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">netmask_bin</span><span class="p">))</span>
                        <span class="n">network</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">address_bin</span> <span class="o">&amp;</span> <span class="n">netmask_bin</span><span class="p">))</span>
                        <span class="n">iface</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">iface</span> <span class="o">!=</span> <span class="n">device</span><span class="p">:</span>
                            <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">secondary</span> <span class="ow">and</span> <span class="s">&quot;ipv4&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">]:</span>
                            <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">][</span><span class="s">&#39;ipv4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span>
                                                         <span class="s">&#39;broadcast&#39;</span><span class="p">:</span> <span class="n">broadcast</span><span class="p">,</span>
                                                         <span class="s">&#39;netmask&#39;</span><span class="p">:</span> <span class="n">netmask</span><span class="p">,</span>
                                                         <span class="s">&#39;network&#39;</span><span class="p">:</span> <span class="n">network</span><span class="p">}</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s">&quot;ipv4_secondaries&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">]:</span>
                                <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">][</span><span class="s">&quot;ipv4_secondaries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">][</span><span class="s">&quot;ipv4_secondaries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span>
                                <span class="s">&#39;broadcast&#39;</span><span class="p">:</span> <span class="n">broadcast</span><span class="p">,</span>
                                <span class="s">&#39;netmask&#39;</span><span class="p">:</span> <span class="n">netmask</span><span class="p">,</span>
                                <span class="s">&#39;network&#39;</span><span class="p">:</span> <span class="n">network</span><span class="p">,</span>
                            <span class="p">})</span>

                        <span class="c"># add this secondary IP to the main device</span>
                        <span class="k">if</span> <span class="n">secondary</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s">&quot;ipv4_secondaries&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]:</span>
                                <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&quot;ipv4_secondaries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&quot;ipv4_secondaries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span>
                                <span class="s">&#39;broadcast&#39;</span><span class="p">:</span> <span class="n">broadcast</span><span class="p">,</span>
                                <span class="s">&#39;netmask&#39;</span><span class="p">:</span> <span class="n">netmask</span><span class="p">,</span>
                                <span class="s">&#39;network&#39;</span><span class="p">:</span> <span class="n">network</span><span class="p">,</span>
                            <span class="p">})</span>

                        <span class="c"># If this is the default address, update default_ipv4</span>
                        <span class="k">if</span> <span class="s">&#39;address&#39;</span> <span class="ow">in</span> <span class="n">default_ipv4</span> <span class="ow">and</span> <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">address</span><span class="p">:</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;broadcast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">broadcast</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;netmask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">netmask</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">network</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macaddress</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span>
                            <span class="n">default_ipv4</span><span class="p">[</span><span class="s">&#39;alias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;127.&#39;</span><span class="p">):</span>
                            <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv4_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet6&#39;</span><span class="p">:</span>
                        <span class="n">address</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
                        <span class="n">scope</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s">&#39;ipv6&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]:</span>
                            <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;ipv6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;ipv6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;address&#39;</span> <span class="p">:</span> <span class="n">address</span><span class="p">,</span>
                            <span class="s">&#39;prefix&#39;</span>  <span class="p">:</span> <span class="n">prefix</span><span class="p">,</span>
                            <span class="s">&#39;scope&#39;</span>   <span class="p">:</span> <span class="n">scope</span>
                        <span class="p">})</span>
                        <span class="c"># If this is the default address, update default_ipv6</span>
                        <span class="k">if</span> <span class="s">&#39;address&#39;</span> <span class="ow">in</span> <span class="n">default_ipv6</span> <span class="ow">and</span> <span class="n">default_ipv6</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">address</span><span class="p">:</span>
                            <span class="n">default_ipv6</span><span class="p">[</span><span class="s">&#39;prefix&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">prefix</span>
                            <span class="n">default_ipv6</span><span class="p">[</span><span class="s">&#39;scope&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">scope</span>
                            <span class="n">default_ipv6</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macaddress</span>
                            <span class="n">default_ipv6</span><span class="p">[</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span>
                            <span class="n">default_ipv6</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span> <span class="o">==</span> <span class="s">&#39;::1&#39;</span><span class="p">:</span>
                            <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv6_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

            <span class="n">ip_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&quot;ip&quot;</span><span class="p">)</span>

            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip_path</span><span class="p">,</span> <span class="s">&#39;addr&#39;</span><span class="p">,</span> <span class="s">&#39;show&#39;</span><span class="p">,</span> <span class="s">&#39;primary&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">]</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="n">primary_data</span> <span class="o">=</span> <span class="n">stdout</span>

            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip_path</span><span class="p">,</span> <span class="s">&#39;addr&#39;</span><span class="p">,</span> <span class="s">&#39;show&#39;</span><span class="p">,</span> <span class="s">&#39;secondary&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">]</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="n">secondary_data</span> <span class="o">=</span> <span class="n">stdout</span>

            <span class="n">parse_ip_output</span><span class="p">(</span><span class="n">primary_data</span><span class="p">)</span>
            <span class="n">parse_ip_output</span><span class="p">(</span><span class="n">secondary_data</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># replace : by _ in interface name since they are hard to use in template</span>
        <span class="n">new_interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">new_interfaces</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_interfaces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_interfaces</span><span class="p">,</span> <span class="n">ips</span></div></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork">[docs]</a><span class="k">class</span> <span class="nc">GenericBsdIfconfigNetwork</span><span class="p">(</span><span class="n">Network</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a generic BSD subclass of Network using the ifconfig command.</span>
<span class="sd">    It defines</span>
<span class="sd">    - interfaces (a list of interface names)</span>
<span class="sd">    - interface_&lt;name&gt; dictionary of ipv4, ipv6, and mac address information.</span>
<span class="sd">    - all_ipv4_addresses and all_ipv6_addresses: lists of all configured addresses.</span>
<span class="sd">    It currently does not define</span>
<span class="sd">    - default_ipv4 and default_ipv6</span>
<span class="sd">    - type, mtu and network on interfaces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Generic_BSD_Ifconfig&#39;</span>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">ifconfig_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;ifconfig&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ifconfig_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span>
        <span class="n">route_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;route&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">route_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span>

        <span class="n">default_ipv4</span><span class="p">,</span> <span class="n">default_ipv6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_interfaces</span><span class="p">(</span><span class="n">route_path</span><span class="p">)</span>
        <span class="n">interfaces</span><span class="p">,</span> <span class="n">ips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interfaces_info</span><span class="p">(</span><span class="n">ifconfig_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_default_interface</span><span class="p">(</span><span class="n">default_ipv4</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="s">&#39;ipv4&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_default_interface</span><span class="p">(</span><span class="n">default_ipv6</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="s">&#39;ipv6&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;default_ipv4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_ipv4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;default_ipv6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_ipv6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;all_ipv4_addresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv4_addresses&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;all_ipv6_addresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv6_addresses&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.get_default_interfaces"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.get_default_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route_path</span><span class="p">):</span>

        <span class="c"># Use the commands:</span>
        <span class="c">#     route -n get 8.8.8.8                            -&gt; Google public DNS</span>
        <span class="c">#     route -n get -inet6 2404:6800:400a:800::1012    -&gt; ipv6.google.com</span>
        <span class="c"># to find out the default outgoing interface, address, and gateway</span>

        <span class="n">command</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">v4</span> <span class="o">=</span> <span class="p">[</span><span class="n">route_path</span><span class="p">,</span> <span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;8.8.8.8&#39;</span><span class="p">],</span>
            <span class="n">v6</span> <span class="o">=</span> <span class="p">[</span><span class="n">route_path</span><span class="p">,</span> <span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;-inet6&#39;</span><span class="p">,</span> <span class="s">&#39;2404:6800:400a:800::1012&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">interface</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">v4</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">v6</span> <span class="o">=</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="s">&#39;v4&#39;</span><span class="p">,</span> <span class="s">&#39;v6&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;v6&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">socket</span><span class="o">.</span><span class="n">has_ipv6</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
                <span class="c"># v6 routing may result in</span>
                <span class="c">#   RTNETLINK answers: Invalid argument</span>
                <span class="k">continue</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c"># Collect output from route command</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;interface:&#39;</span><span class="p">:</span>
                        <span class="n">interface</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;gateway:&#39;</span><span class="p">:</span>
                        <span class="n">interface</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;gateway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v4&#39;</span><span class="p">],</span> <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v6&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.get_interfaces_info"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.get_interfaces_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifconfig_path</span><span class="p">,</span> <span class="n">ifconfig_options</span><span class="o">=</span><span class="s">&#39;-a&#39;</span><span class="p">):</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">current_if</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ips</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">all_ipv4_addresses</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">all_ipv6_addresses</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="p">)</span>
        <span class="c"># FreeBSD, DragonflyBSD, NetBSD, OpenBSD and OS X all implicitly add &#39;-a&#39;</span>
        <span class="c"># when running the command &#39;ifconfig&#39;.</span>
        <span class="c"># Solaris must explicitly run the command &#39;ifconfig -a&#39;.</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">ifconfig_path</span><span class="p">,</span> <span class="n">ifconfig_options</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;pass&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^\S&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">current_if</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_interface_line</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
                    <span class="n">interfaces</span><span class="p">[</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="n">current_if</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;options=&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_options_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nd6&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_nd6_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ether&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_ether_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;media:&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_media_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;status:&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_status_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lladdr&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_lladdr_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_inet_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet6&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_inet6_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_unknown_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">ips</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_interface_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_interface_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_interface_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">current_if</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s">&#39;ipv4&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ipv6&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;unknown&#39;</span><span class="p">}</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>    <span class="c"># will be overwritten later</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="p">:</span> <span class="c"># Newer FreeBSD versions</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;metric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">current_if</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_options_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_options_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_options_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="c"># Mac has options like this...</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_nd6_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_nd6_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_nd6_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="c"># FreeBSD has options like this...</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_ether_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_ether_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_ether_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_media_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_media_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_media_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="c"># not sure if this is useful - we also drop information</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_status_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_status_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_status_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_lladdr_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_lladdr_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_lladdr_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;lladdr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_inet_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_inet_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_inet_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
        <span class="c"># deal with hex netmask</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;([0-9a-f]){8}&#39;</span><span class="p">,</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0x&#39;</span> <span class="o">+</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;0x&#39;</span><span class="p">):</span>
            <span class="n">address</span><span class="p">[</span><span class="s">&#39;netmask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># otherwise assume this is a dotted quad</span>
            <span class="n">address</span><span class="p">[</span><span class="s">&#39;netmask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="c"># calculate the network</span>
        <span class="n">address_bin</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">netmask_bin</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="s">&#39;netmask&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">address</span><span class="p">[</span><span class="s">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">address_bin</span> <span class="o">&amp;</span> <span class="n">netmask_bin</span><span class="p">))</span>
        <span class="c"># broadcast may be given or we need to calculate</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">address</span><span class="p">[</span><span class="s">&#39;broadcast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">address</span><span class="p">[</span><span class="s">&#39;broadcast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;!L&#39;</span><span class="p">,</span> <span class="n">address_bin</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="n">netmask_bin</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)))</span>
        <span class="c"># add to our list of addresses</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;127.&#39;</span><span class="p">):</span>
            <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv4_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">])</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;ipv4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_inet6_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_inet6_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_inet6_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;prefixlen&#39;</span><span class="p">):</span>
            <span class="n">address</span><span class="p">[</span><span class="s">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;scopeid&#39;</span><span class="p">):</span>
            <span class="n">address</span><span class="p">[</span><span class="s">&#39;scope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">localhost6</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;::1&#39;</span><span class="p">,</span> <span class="s">&#39;::1/128&#39;</span><span class="p">,</span> <span class="s">&#39;fe80::1</span><span class="si">%lo</span><span class="s">0&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">address</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">localhost6</span><span class="p">:</span>
            <span class="n">ips</span><span class="p">[</span><span class="s">&#39;all_ipv6_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">])</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;ipv6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.parse_unknown_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.parse_unknown_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_unknown_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="c"># we are going to ignore unknown lines here - this may be</span>
        <span class="c"># a bad idea - but you can override it in your subclass</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.get_options"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.get_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_string</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">option_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&lt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">option_string</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">option_csv</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">option_csv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="GenericBsdIfconfigNetwork.merge_default_interface"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.GenericBsdIfconfigNetwork.merge_default_interface">[docs]</a>    <span class="k">def</span> <span class="nf">merge_default_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">ip_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;interface&#39;</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;interface&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">ifinfo</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">defaults</span><span class="p">[</span><span class="s">&#39;interface&#39;</span><span class="p">]]</span>
        <span class="c"># copy all the interface values across except addresses</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ifinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="s">&#39;ipv4&#39;</span> <span class="ow">and</span> <span class="n">item</span> <span class="o">!=</span> <span class="s">&#39;ipv6&#39;</span><span class="p">:</span>
                <span class="n">defaults</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifinfo</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifinfo</span><span class="p">[</span><span class="n">ip_type</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ifinfo</span><span class="p">[</span><span class="n">ip_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">defaults</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifinfo</span><span class="p">[</span><span class="n">ip_type</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">item</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="HPUXNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXNetwork">[docs]</a><span class="k">class</span> <span class="nc">HPUXNetwork</span><span class="p">(</span><span class="n">Network</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HP-UX-specifig subclass of Network. Defines networking facts:</span>
<span class="sd">    - default_interface</span>
<span class="sd">    - interfaces (a list of interface names)</span>
<span class="sd">    - interface_&lt;name&gt; dictionary of ipv4 address information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;HP-UX&#39;</span>

<div class="viewcode-block" id="HPUXNetwork.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXNetwork.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">netstat_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;netstat&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">netstat_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_default_interfaces</span><span class="p">()</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interfaces_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="HPUXNetwork.get_default_interfaces"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXNetwork.get_default_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/netstat -nr&quot;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;default&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;default_interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;default_gateway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="HPUXNetwork.get_interfaces_info"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXNetwork.get_interfaces_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/netstat -ni&quot;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lan&#39;</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span> <span class="p">}</span>
                    <span class="n">address</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;ipv4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span> <span class="p">}</span>
                    <span class="n">network</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s">&#39;ipv4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;network&#39;</span><span class="p">:</span> <span class="n">network</span><span class="p">,</span>
                                                   <span class="s">&#39;interface&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
                                                   <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">interfaces</span></div></div>

<div class="viewcode-block" id="DarwinNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.DarwinNetwork">[docs]</a><span class="k">class</span> <span class="nc">DarwinNetwork</span><span class="p">(</span><span class="n">GenericBsdIfconfigNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the Mac OS X/Darwin Network Class.</span>
<span class="sd">    It uses the GenericBsdIfconfigNetwork unchanged</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Darwin&#39;</span>

    <span class="c"># media line is different to the default FreeBSD one</span>
<div class="viewcode-block" id="DarwinNetwork.parse_media_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.DarwinNetwork.parse_media_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_media_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="c"># not sure if this is useful - we also drop information</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Unknown&#39;</span> <span class="c"># Mac does not give us this</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># MacOSX sets the media to &#39;&lt;unknown type&gt;&#39; for bridge interface</span>
            <span class="c"># and parsing splits this into two words; this if/else helps</span>
            <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&lt;unknown&#39;</span> <span class="ow">and</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;type&gt;&#39;</span><span class="p">:</span>
                <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Unknown&#39;</span>
                <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown type&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;media_options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="FreeBSDNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDNetwork">[docs]</a><span class="k">class</span> <span class="nc">FreeBSDNetwork</span><span class="p">(</span><span class="n">GenericBsdIfconfigNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the FreeBSD Network Class.</span>
<span class="sd">    It uses the GenericBsdIfconfigNetwork unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;FreeBSD&#39;</span></div>

<div class="viewcode-block" id="DragonFlyNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.DragonFlyNetwork">[docs]</a><span class="k">class</span> <span class="nc">DragonFlyNetwork</span><span class="p">(</span><span class="n">GenericBsdIfconfigNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the DragonFly Network Class.</span>
<span class="sd">    It uses the GenericBsdIfconfigNetwork unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;DragonFly&#39;</span></div>

<div class="viewcode-block" id="AIXNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIXNetwork">[docs]</a><span class="k">class</span> <span class="nc">AIXNetwork</span><span class="p">(</span><span class="n">GenericBsdIfconfigNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the AIX Network Class.</span>
<span class="sd">    It uses the GenericBsdIfconfigNetwork unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;AIX&#39;</span>

<div class="viewcode-block" id="AIXNetwork.get_default_interfaces"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIXNetwork.get_default_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route_path</span><span class="p">):</span>
        <span class="n">netstat_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;netstat&#39;</span><span class="p">)</span>

        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">netstat_path</span><span class="p">,</span> <span class="s">&#39;-nr&#39;</span><span class="p">])</span>

        <span class="n">interface</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">v4</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">v6</span> <span class="o">=</span> <span class="p">{})</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;default&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v4&#39;</span><span class="p">][</span><span class="s">&#39;gateway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v4&#39;</span><span class="p">][</span><span class="s">&#39;interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v6&#39;</span><span class="p">][</span><span class="s">&#39;gateway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v6&#39;</span><span class="p">][</span><span class="s">&#39;interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v4&#39;</span><span class="p">],</span> <span class="n">interface</span><span class="p">[</span><span class="s">&#39;v6&#39;</span><span class="p">]</span></div>

    <span class="c"># AIX &#39;ifconfig -a&#39; does not have three words in the interface line</span>
<div class="viewcode-block" id="AIXNetwork.get_interfaces_info"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIXNetwork.get_interfaces_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifconfig_path</span><span class="p">,</span> <span class="n">ifconfig_options</span><span class="o">=</span><span class="s">&#39;-a&#39;</span><span class="p">):</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">current_if</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ips</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">all_ipv4_addresses</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">all_ipv6_addresses</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="p">)</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">ifconfig_path</span><span class="p">,</span> <span class="n">ifconfig_options</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="c"># only this condition differs from GenericBsdIfconfigNetwork</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^\w*\d*:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">current_if</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_interface_line</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
                    <span class="n">interfaces</span><span class="p">[</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="n">current_if</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;options=&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_options_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nd6&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_nd6_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ether&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_ether_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;media:&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_media_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;status:&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_status_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lladdr&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_lladdr_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_inet_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet6&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_inet6_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_unknown_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
            <span class="n">uname_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;uname&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uname_path</span><span class="p">:</span>
                <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">uname_path</span><span class="p">,</span> <span class="s">&#39;-W&#39;</span><span class="p">])</span>
                <span class="c"># don&#39;t bother with wpars it does not work</span>
                <span class="c"># zero means not in wpar</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^en&#39;</span><span class="p">,</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]):</span>
                        <span class="n">entstat_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;entstat&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">entstat_path</span><span class="p">:</span>
                            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">entstat_path</span><span class="p">,</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span> <span class="p">])</span>
                            <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                                    <span class="k">pass</span>
                                <span class="n">buff</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^Hardware Address: (.*)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">buff</span><span class="p">:</span>
                                    <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">buff</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                                <span class="n">buff</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^Device Type:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">buff</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;.*Ethernet&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                                    <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ether&#39;</span>
                    <span class="c"># device must have mtu attribute in ODM</span>
                    <span class="k">if</span> <span class="s">&#39;mtu&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_if</span><span class="p">:</span>
                        <span class="n">lsattr_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;lsattr&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lsattr_path</span><span class="p">:</span>
                            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">lsattr_path</span><span class="p">,</span><span class="s">&#39;-El&#39;</span><span class="p">,</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span> <span class="p">])</span>
                            <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                                    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;mtu&#39;</span><span class="p">:</span>
                                        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">ips</span></div>

    <span class="c"># AIX &#39;ifconfig -a&#39; does not inform about MTU, so remove current_if[&#39;mtu&#39;] here</span>
<div class="viewcode-block" id="AIXNetwork.parse_interface_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.AIXNetwork.parse_interface_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_interface_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">current_if</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s">&#39;ipv4&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ipv6&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;unknown&#39;</span><span class="p">}</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>    <span class="c"># will be overwritten later</span>
        <span class="k">return</span> <span class="n">current_if</span></div></div>

<div class="viewcode-block" id="OpenBSDNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDNetwork">[docs]</a><span class="k">class</span> <span class="nc">OpenBSDNetwork</span><span class="p">(</span><span class="n">GenericBsdIfconfigNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the OpenBSD Network Class.</span>
<span class="sd">    It uses the GenericBsdIfconfigNetwork.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;OpenBSD&#39;</span>

    <span class="c"># OpenBSD &#39;ifconfig -a&#39; does not have information about aliases</span>
<div class="viewcode-block" id="OpenBSDNetwork.get_interfaces_info"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDNetwork.get_interfaces_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifconfig_path</span><span class="p">,</span> <span class="n">ifconfig_options</span><span class="o">=</span><span class="s">&#39;-aA&#39;</span><span class="p">):</span>
       <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OpenBSDNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_interfaces_info</span><span class="p">(</span><span class="n">ifconfig_path</span><span class="p">,</span> <span class="n">ifconfig_options</span><span class="p">)</span></div>

    <span class="c"># Return macaddress instead of lladdr</span>
<div class="viewcode-block" id="OpenBSDNetwork.parse_lladdr_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDNetwork.parse_lladdr_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_lladdr_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="SunOSNetwork"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSNetwork">[docs]</a><span class="k">class</span> <span class="nc">SunOSNetwork</span><span class="p">(</span><span class="n">GenericBsdIfconfigNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the SunOS Network Class.</span>
<span class="sd">    It uses the GenericBsdIfconfigNetwork.</span>

<span class="sd">    Solaris can have different FLAGS and MTU for IPv4 and IPv6 on the same interface</span>
<span class="sd">    so these facts have been moved inside the &#39;ipv4&#39; and &#39;ipv6&#39; lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;SunOS&#39;</span>

    <span class="c"># Solaris &#39;ifconfig -a&#39; will print interfaces twice, once for IPv4 and again for IPv6.</span>
    <span class="c"># MTU and FLAGS also may differ between IPv4 and IPv6 on the same interface.</span>
    <span class="c"># &#39;parse_interface_line()&#39; checks for previously seen interfaces before defining</span>
    <span class="c"># &#39;current_if&#39; so that IPv6 facts don&#39;t clobber IPv4 facts (or vice versa).</span>
<div class="viewcode-block" id="SunOSNetwork.get_interfaces_info"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSNetwork.get_interfaces_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifconfig_path</span><span class="p">):</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">current_if</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ips</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">all_ipv4_addresses</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">all_ipv6_addresses</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="p">)</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="n">ifconfig_path</span><span class="p">,</span> <span class="s">&#39;-a&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^\S&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">current_if</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_interface_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">)</span>
                    <span class="n">interfaces</span><span class="p">[</span> <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="n">current_if</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;options=&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_options_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nd6&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_nd6_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ether&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_ether_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;media:&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_media_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;status:&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_status_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lladdr&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_lladdr_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_inet_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inet6&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_inet6_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_unknown_line</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">)</span>

        <span class="c"># &#39;parse_interface_line&#39; and &#39;parse_inet*_line&#39; leave two dicts in the</span>
        <span class="c"># ipv4/ipv6 lists which is ugly and hard to read.</span>
        <span class="c"># This quick hack merges the dictionaries. Purely cosmetic.</span>
        <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="s">&#39;ipv4&#39;</span><span class="p">,</span> <span class="s">&#39;ipv6&#39;</span><span class="p">:</span>
                <span class="n">combined_facts</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">facts</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">][</span><span class="n">v</span><span class="p">]:</span>
                    <span class="n">combined_facts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">facts</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined_facts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">interfaces</span><span class="p">[</span><span class="n">iface</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">combined_facts</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">ips</span></div>

<div class="viewcode-block" id="SunOSNetwork.parse_interface_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSNetwork.parse_interface_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_interface_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">):</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">current_if</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s">&#39;ipv4&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ipv6&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;unknown&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_if</span> <span class="o">=</span> <span class="n">interfaces</span><span class="p">[</span><span class="n">device</span><span class="p">]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="s">&#39;ipv4&#39;</span>
        <span class="k">if</span> <span class="s">&#39;IPv6&#39;</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="s">&#39;ipv6&#39;</span>
        <span class="n">current_if</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;flags&#39;</span><span class="p">:</span> <span class="n">flags</span><span class="p">,</span> <span class="s">&#39;mtu&#39;</span><span class="p">:</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]})</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>    <span class="c"># will be overwritten later</span>
        <span class="k">return</span> <span class="n">current_if</span></div>

    <span class="c"># Solaris displays single digit octets in MAC addresses e.g. 0:1:2:d:e:f</span>
    <span class="c"># Add leading zero to each octet where needed.</span>
<div class="viewcode-block" id="SunOSNetwork.parse_ether_line"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSNetwork.parse_ether_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_ether_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">current_if</span><span class="p">,</span> <span class="n">ips</span><span class="p">):</span>
        <span class="n">macaddress</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">octet</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">):</span>
            <span class="n">octet</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="n">octet</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">macaddress</span> <span class="o">+=</span> <span class="p">(</span><span class="n">octet</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">current_if</span><span class="p">[</span><span class="s">&#39;macaddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macaddress</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="Virtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Virtual">[docs]</a><span class="k">class</span> <span class="nc">Virtual</span><span class="p">(</span><span class="n">Facts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a generic Virtual subclass of Facts.  This should be further</span>
<span class="sd">    subclassed to implement per platform.  If you subclass this,</span>
<span class="sd">    you should define:</span>
<span class="sd">    - virtualization_type</span>
<span class="sd">    - virtualization_role</span>
<span class="sd">    - container (e.g. solaris zones, freebsd jails, linux containers)</span>

<span class="sd">    All subclasses MUST define platform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keyword</span><span class="p">):</span>
        <span class="n">subclass</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span><span class="n">Virtual</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">():</span>
                <span class="n">subclass</span> <span class="o">=</span> <span class="n">sc</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keyword</span><span class="p">)</span>

<div class="viewcode-block" id="Virtual.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Virtual.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div></div>

<div class="viewcode-block" id="LinuxVirtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxVirtual">[docs]</a><span class="k">class</span> <span class="nc">LinuxVirtual</span><span class="p">(</span><span class="n">Virtual</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a Linux-specific subclass of Virtual.  It defines</span>
<span class="sd">    - virtualization_type</span>
<span class="sd">    - virtualization_role</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;Linux&#39;</span>

<div class="viewcode-block" id="LinuxVirtual.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxVirtual.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_virtual_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

    <span class="c"># For more information, check: http://people.redhat.com/~rjones/virt-what/</span>
<div class="viewcode-block" id="LinuxVirtual.get_virtual_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.LinuxVirtual.get_virtual_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_virtual_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/proc/1/cgroup&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/proc/1/cgroup&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;/docker(/|-[0-9a-f]+\.scope)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;docker&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;/lxc/&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;lxc&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                    <span class="k">return</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/proc/vz&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;openvz&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/proc/bc&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="n">systemd_container</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/run/systemd/container&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">systemd_container</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">systemd_container</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;/proc/xen&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;xen&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/proc/xen/capabilities&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s">&quot;control_d&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host&#39;</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span>

        <span class="n">product_name</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/sys/devices/virtual/dmi/id/product_name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;KVM&#39;</span><span class="p">,</span> <span class="s">&#39;Bochs&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;kvm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s">&#39;RHEV Hypervisor&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;RHEV&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s">&#39;VMware Virtual Platform&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;VMware&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="n">bios_vendor</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/sys/devices/virtual/dmi/id/bios_vendor&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bios_vendor</span> <span class="o">==</span> <span class="s">&#39;Xen&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;xen&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">bios_vendor</span> <span class="o">==</span> <span class="s">&#39;innotek GmbH&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;virtualbox&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="n">sys_vendor</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="s">&#39;/sys/devices/virtual/dmi/id/sys_vendor&#39;</span><span class="p">)</span>

        <span class="c"># FIXME: This does also match hyperv</span>
        <span class="k">if</span> <span class="n">sys_vendor</span> <span class="o">==</span> <span class="s">&#39;Microsoft Corporation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;VirtualPC&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">sys_vendor</span> <span class="o">==</span> <span class="s">&#39;Parallels Software International Inc.&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;parallels&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">sys_vendor</span> <span class="o">==</span> <span class="s">&#39;QEMU&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;kvm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">sys_vendor</span> <span class="o">==</span> <span class="s">&#39;oVirt&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;kvm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/proc/self/status&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/proc/self/status&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^VxID: \d+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;linux_vserver&#39;</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^VxID: 0&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                    <span class="k">return</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/proc/cpuinfo&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&#39;/proc/cpuinfo&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^model name.*QEMU Virtual CPU&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;kvm&#39;</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^vendor_id.*User Mode Linux&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;uml&#39;</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^model name.*UML&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;uml&#39;</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^vendor_id.*PowerVM Lx86&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;powervm_lx86&#39;</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^vendor_id.*IBM/S390&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;PR/SM&#39;</span>
                    <span class="n">lscpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;lscpu&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lscpu</span><span class="p">:</span>
                        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">([</span><span class="s">&quot;lscpu&quot;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                                <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                                <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;Hypervisor&#39;</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ibm_systemz&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PR/SM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;LPAR&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                <span class="k">return</span>

        <span class="c"># Beware that we can have both kvm and virtualbox running on a single system</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;/proc/modules&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&#39;/proc/modules&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_file_lines</span><span class="p">(</span><span class="s">&quot;/proc/modules&quot;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="s">&#39;kvm&#39;</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;kvm&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host&#39;</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="s">&#39;vboxdrv&#39;</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;virtualbox&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host&#39;</span>
                <span class="k">return</span>

        <span class="c"># If none of the above matches, return &#39;NA&#39; for virtualization_type</span>
        <span class="c"># and virtualization_role. This allows for proper grouping.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NA&#39;</span>
        <span class="k">return</span></div></div>

<div class="viewcode-block" id="FreeBSDVirtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDVirtual">[docs]</a><span class="k">class</span> <span class="nc">FreeBSDVirtual</span><span class="p">(</span><span class="n">Virtual</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a FreeBSD-specific subclass of Virtual.  It defines</span>
<span class="sd">    - virtualization_type</span>
<span class="sd">    - virtualization_role</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;FreeBSD&#39;</span>

<div class="viewcode-block" id="FreeBSDVirtual.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDVirtual.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_virtual_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="FreeBSDVirtual.get_virtual_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.FreeBSDVirtual.get_virtual_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_virtual_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span></div></div>

<div class="viewcode-block" id="DragonFlyVirtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.DragonFlyVirtual">[docs]</a><span class="k">class</span> <span class="nc">DragonFlyVirtual</span><span class="p">(</span><span class="n">FreeBSDVirtual</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="OpenBSDVirtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDVirtual">[docs]</a><span class="k">class</span> <span class="nc">OpenBSDVirtual</span><span class="p">(</span><span class="n">Virtual</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a OpenBSD-specific subclass of Virtual.  It defines</span>
<span class="sd">    - virtualization_type</span>
<span class="sd">    - virtualization_role</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;OpenBSD&#39;</span>

<div class="viewcode-block" id="OpenBSDVirtual.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDVirtual.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_virtual_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="OpenBSDVirtual.get_virtual_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.OpenBSDVirtual.get_virtual_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_virtual_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span></div></div>

<div class="viewcode-block" id="HPUXVirtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXVirtual">[docs]</a><span class="k">class</span> <span class="nc">HPUXVirtual</span><span class="p">(</span><span class="n">Virtual</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a HP-UX specific subclass of Virtual. It defines</span>
<span class="sd">    - virtualization_type</span>
<span class="sd">    - virtualization_role</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;HP-UX&#39;</span>

<div class="viewcode-block" id="HPUXVirtual.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXVirtual.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_virtual_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="HPUXVirtual.get_virtual_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.HPUXVirtual.get_virtual_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_virtual_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/usr/sbin/vecheck&#39;</span><span class="p">):</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/vecheck&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;HP vPar&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/opt/hpvm/bin/hpvminfo&#39;</span><span class="p">):</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/opt/hpvm/bin/hpvminfo&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;.*Running.*HPVM vPar.*&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;HPVM vPar&#39;</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;.*Running.*HPVM guest.*&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;HPVM IVM&#39;</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;.*Running.*HPVM host.*&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;HPVM&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/usr/sbin/parstatus&#39;</span><span class="p">):</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/parstatus&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;HP nPar&#39;</span></div></div>


<div class="viewcode-block" id="SunOSVirtual"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSVirtual">[docs]</a><span class="k">class</span> <span class="nc">SunOSVirtual</span><span class="p">(</span><span class="n">Virtual</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a SunOS-specific subclass of Virtual.  It defines</span>
<span class="sd">    - virtualization_type</span>
<span class="sd">    - virtualization_role</span>
<span class="sd">    - container</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;SunOS&#39;</span>

<div class="viewcode-block" id="SunOSVirtual.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSVirtual.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_virtual_facts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="SunOSVirtual.get_virtual_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.SunOSVirtual.get_virtual_facts">[docs]</a>    <span class="k">def</span> <span class="nf">get_virtual_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/prtdiag&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;VMware&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;vmware&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">if</span> <span class="s">&#39;Parallels&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;parallels&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">if</span> <span class="s">&#39;VirtualBox&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;virtualbox&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
            <span class="k">if</span> <span class="s">&#39;HVM domU&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;xen&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
        <span class="c"># Check if it&#39;s a zone</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;/usr/bin/zonename&quot;</span><span class="p">):</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/bin/zonename&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;global&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;zone&#39;</span>
        <span class="c"># Check if it&#39;s a branded zone (i.e. Solaris 8/9 zone)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s">&#39;/.SUNWnative&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;zone&#39;</span>
        <span class="c"># If it&#39;s a zone check if we can detect if our global zone is itself virtualized.</span>
        <span class="c"># Relies on the &quot;guest tools&quot; (e.g. vmware tools) to be installed</span>
        <span class="k">if</span> <span class="s">&#39;container&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;container&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;zone&#39;</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/modinfo&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="s">&#39;VMware&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;vmware&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                <span class="k">if</span> <span class="s">&#39;VirtualBox&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;virtualbox&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
        <span class="c"># Detect domaining on Sparc hardware</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;/usr/sbin/virtinfo&quot;</span><span class="p">):</span>
            <span class="c"># The output of virtinfo is different whether we are on a machine with logical</span>
            <span class="c"># domains (&#39;LDoms&#39;) on a T-series or domains (&#39;Domains&#39;) on a M-series. Try LDoms first.</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&quot;/usr/sbin/virtinfo -p&quot;</span><span class="p">)</span>
            <span class="c"># The output contains multiple lines with different keys like this:</span>
            <span class="c">#   DOMAINROLE|impl=LDoms|control=false|io=false|service=false|root=false</span>
            <span class="c"># The output may also be not formatted and the returncode is set to 0 regardless of the error condition:</span>
            <span class="c">#   virtinfo can only be run from the global zone</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;DOMAINROLE&#39;</span> <span class="ow">and</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;impl=LDoms&#39;</span> <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ldom&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;guest&#39;</span>
                        <span class="n">hostfeatures</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                            <span class="n">arg</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;true&#39;</span> <span class="p">):</span>
                                <span class="n">hostfeatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">hostfeatures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;virtualization_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;host (&#39;</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hostfeatures</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Ohai"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Ohai">[docs]</a><span class="k">class</span> <span class="nc">Ohai</span><span class="p">(</span><span class="n">Facts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a subclass of Facts for including information gathered from Ohai.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Ohai.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Ohai.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_ohai</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="Ohai.run_ohai"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Ohai.run_ohai">[docs]</a>    <span class="k">def</span> <span class="nf">run_ohai</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ohai_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;ohai&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ohai_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">ohai_path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Facter"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facter">[docs]</a><span class="k">class</span> <span class="nc">Facter</span><span class="p">(</span><span class="n">Facts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a subclass of Facts for including information gathered from Facter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Facter.populate"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facter.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_facter</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">facts</span></div>

<div class="viewcode-block" id="Facter.run_facter"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.Facter.run_facter">[docs]</a>    <span class="k">def</span> <span class="nf">run_facter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">facter_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;facter&#39;</span><span class="p">,</span> <span class="n">opt_dirs</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;/opt/puppetlabs/bin&#39;</span><span class="p">])</span>
        <span class="n">cfacter_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_bin_path</span><span class="p">(</span><span class="s">&#39;cfacter&#39;</span><span class="p">,</span> <span class="n">opt_dirs</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;/opt/puppetlabs/bin&#39;</span><span class="p">])</span>
        <span class="c"># Prefer to use cfacter if available</span>
        <span class="k">if</span> <span class="n">cfacter_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">facter_path</span> <span class="o">=</span> <span class="n">cfacter_path</span>

        <span class="k">if</span> <span class="n">facter_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># if facter is installed, and we can use --json because</span>
        <span class="c"># ruby-json is ALSO installed, include facter data in the JSON</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">facter_path</span> <span class="o">+</span> <span class="s">&quot; --puppet --json&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facts</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div></div>


<div class="viewcode-block" id="get_file_content"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.get_file_content">[docs]</a><span class="k">def</span> <span class="nf">get_file_content</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">default</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># ignore errors as some jails/containers might have readable permissions but not allow reads to proc</span>
            <span class="c"># done in 2 blocks for 2.4 compat</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="get_file_lines"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.get_file_lines">[docs]</a><span class="k">def</span> <span class="nf">get_file_lines</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;get list of lines from file&#39;&#39;&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="ansible_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.ansible_facts">[docs]</a><span class="k">def</span> <span class="nf">ansible_facts</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">gather_subset</span><span class="p">):</span>
    <span class="n">facts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">facts</span><span class="p">[</span><span class="s">&#39;gather_subset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gather_subset</span><span class="p">)</span>
    <span class="n">facts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Facts</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">gather_subset</span><span class="p">:</span>
        <span class="n">facts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">FACT_SUBSETS</span><span class="p">[</span><span class="n">subset</span><span class="p">](</span><span class="n">module</span><span class="p">,</span>
                                         <span class="n">load_on_init</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                         <span class="n">cached_facts</span><span class="o">=</span><span class="n">facts</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">facts</span></div>

<div class="viewcode-block" id="get_all_facts"><a class="viewcode-back" href="../../../rst/ansible.module_utils.html#ansible.module_utils.facts.get_all_facts">[docs]</a><span class="k">def</span> <span class="nf">get_all_facts</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>

    <span class="n">setup_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">module_setup</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># Retrieve module parameters</span>
    <span class="n">gather_subset</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;gather_subset&#39;</span><span class="p">]</span>

    <span class="c"># Retrieve all facts elements</span>
    <span class="n">additional_subsets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">exclude_subsets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">gather_subset</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subset</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">additional_subsets</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">VALID_SUBSETS</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">subset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">):</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">subset</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">exclude_subsets</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">VALID_SUBSETS</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_SUBSETS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Bad subset &#39;</span><span class="si">%s</span><span class="s">&#39; given to Ansible. gather_subset options allowed: all, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FACT_SUBSETS</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">exclude_subsets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">additional_subsets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">additional_subsets</span><span class="p">:</span>
        <span class="n">additional_subsets</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">VALID_SUBSETS</span><span class="p">)</span>

    <span class="n">additional_subsets</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">exclude_subsets</span><span class="p">)</span>

    <span class="c"># facter and ohai are given a different prefix than other subsets</span>
    <span class="k">if</span> <span class="s">&#39;facter&#39;</span> <span class="ow">in</span> <span class="n">additional_subsets</span><span class="p">:</span>
        <span class="n">additional_subsets</span><span class="o">.</span><span class="n">difference_update</span><span class="p">((</span><span class="s">&#39;facter&#39;</span><span class="p">,))</span>
        <span class="n">facter_ds</span> <span class="o">=</span> <span class="n">FACT_SUBSETS</span><span class="p">[</span><span class="s">&#39;facter&#39;</span><span class="p">](</span><span class="n">module</span><span class="p">,</span> <span class="n">load_on_init</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">facter_ds</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">facter_ds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">setup_options</span><span class="p">[</span><span class="s">&#39;facter_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">if</span> <span class="s">&#39;ohai&#39;</span> <span class="ow">in</span> <span class="n">additional_subsets</span><span class="p">:</span>
        <span class="n">additional_subsets</span><span class="o">.</span><span class="n">difference_update</span><span class="p">((</span><span class="s">&#39;ohai&#39;</span><span class="p">,))</span>
        <span class="n">ohai_ds</span> <span class="o">=</span> <span class="n">FACT_SUBSETS</span><span class="p">[</span><span class="s">&#39;ohai&#39;</span><span class="p">](</span><span class="n">module</span><span class="p">,</span> <span class="n">load_on_init</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ohai_ds</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ohai_ds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">setup_options</span><span class="p">[</span><span class="s">&#39;ohai_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">facts</span> <span class="o">=</span> <span class="n">ansible_facts</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">additional_subsets</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">facts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">setup_options</span><span class="p">[</span><span class="s">&quot;ansible_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">setup_result</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;ansible_facts&#39;</span><span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">setup_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;filter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span> <span class="ow">or</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;filter&#39;</span><span class="p">]):</span>
            <span class="n">setup_result</span><span class="p">[</span><span class="s">&#39;ansible_facts&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c"># hack to keep --verbose from showing all the setup module results</span>
    <span class="n">setup_result</span><span class="p">[</span><span class="s">&#39;_ansible_verbose_override&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">setup_result</span></div>

<span class="c"># Allowed fact subset for gather_subset options and what classes they use</span>
<span class="c"># Note: have to define this at the bottom as it references classes defined earlier in this file</span>
<span class="n">FACT_SUBSETS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">hardware</span><span class="o">=</span><span class="n">Hardware</span><span class="p">,</span>
    <span class="n">network</span><span class="o">=</span><span class="n">Network</span><span class="p">,</span>
    <span class="n">virtual</span><span class="o">=</span><span class="n">Virtual</span><span class="p">,</span>
    <span class="n">ohai</span><span class="o">=</span><span class="n">Ohai</span><span class="p">,</span>
    <span class="n">facter</span><span class="o">=</span><span class="n">Facter</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">VALID_SUBSETS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">FACT_SUBSETS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Red Hat.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>